2006-05-27  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Bump version to 0.2.11.

	* NEWS: Bump version to 0.2.11.

	* configure.ac: Bump version to 0.2.11.

2006-05-27  Roger Leigh  <rleigh@debian.org>

	* Version 0.2.10.

	* debian/changelog: Update for 0.2.10.

2006-05-27  Roger Leigh  <rleigh@debian.org>

	* schroot/setup/50chrootname: Strip session UUID when writing
	/etc/debian_chroot.

2006-05-15  Roger Leigh  <rleigh@debian.org>

	* po/sv.po: Updated translated from the Free Translation Project.

2006-05-14  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot-config.cc (add): If a chroot alias is the
	same as the chroot name, don't warn about it, because the effect
	is still unambiguous.

2006-04-30  Roger Leigh  <rleigh@debian.org>

	* Remove unused .cvsignore files.

2006-04-30  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.cc: Update documentation.

	* schroot/schroot-releaselock.cc: Update documentation.

2006-04-30  Roger Leigh  <rleigh@debian.org>

	* debian/control (Standards-Version): Upgrade to 3.7.0.

2006-04-30  Roger Leigh  <rleigh@debian.org>

	* configure.ac: Bump version to 0.2.10.

	* NEWS: Bump version to 0.2.10.

	* debian/changelog: Bump version to 0.2.10-1.

2006-04-30  Roger Leigh  <rleigh@debian.org>

	* Makefile.am (dist-hook): Don't distribute .svn directories.

2006-04-30  Roger Leigh  <rleigh@debian.org>

	* Version 0.2.9.

	* debian/changelog: Update for 0.2.9.

	* po/en_GB.po: Updated British English translation.

	* README: Document new compiler requirements.

2006-04-30  Roger Leigh  <rleigh@debian.org>

	* NEWS: Document directory behaviour.

	* schroot/sbuild-session.cc (run_child): If the current working
	directory does not exist inside the chroot, change to the home
	directory (for login shells), or fail with an error (for commands)
	where the behaviour must be deterministic.

2006-04-30  Roger Leigh  <rleigh@debian.org>

	* test/sbuild-parse-value.cc: Update tests.

	* schroot/sbuild-keyfile.h (get_value): Catch exceptions thrown by
	parse errors and log a warning.

	* schroot/sbuild-environment.h (get): Catch exceptions thrown by
	parse errors and log a warning.

	* schroot/sbuild-parse-value.cc (parse_value): Add class
	constructor and destructor.
	(parse): Parse functions use this->value rather than a string
	value argument.

	* schroot/sbuild-parse-value.h: Move parse_value functions into
	the generic_value class as private parse methods; the string value
	is taken directly from this->value, rather than passed as an
	argument.  generic_value class renamed to parse_value.  On parse
	failure, an exception is thrown.

2006-04-29  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-keyfile.h: Update documentation.

2006-04-29  Roger Leigh  <rleigh@debian.org>

	* TODO: Remove completed file repack item.

2006-04-29  Roger Leigh  <rleigh@debian.org>

	* test/sbuild-chroot-file.cc (chroot_file>): Check for
	CHROOT_FILE_REPACK in the environment.

2006-04-29  Roger Leigh  <rleigh@debian.org>

	* NEWS: Document GCC portability.

	* test/Makefile.am (AM_CXXFLAGS): Remove -Wextra, for GCC 3.3/3.4
	portability.

	* schroot/sbuild-chroot-config.cc (load_data): Construct
	__gnu_cxx::stdio_filebuf appropriately, depending on the required
	construction semantics.

	* schroot/sbuild-chroot.cc (setup_session_info): Construct
	__gnu_cxx::stdio_filebuf appropriately, depending on the required
	construction semantics.

	* configure.ac: Check whether the old (GCC < 3.4) or new (GCC >=
	3.4) __gnu_cxx::stdio_filebuf construction semantics are required,
	for portability to older GCC versions.

2006-04-26  Roger Leigh  <rleigh@debian.org>

	* schroot/setup/10mount (do_mount) : Create directories for
	mounting filesystems onto if they don't exist.

2006-04-26  Roger Leigh  <rleigh@debian.org>

	* po/POTFILES.in: Add schroot/sbuild-format-detail.h

2006-04-26  Roger Leigh  <rleigh@debian.org>

	* GCC 4.2 compatibility fixes.

	* test/sbuild-keyfile.cc (test_set_value): Use iterator ranges,
	rather than whole containers, when calling
	keyfile::set_list_value.

	* schroot/sbuild-chroot-source.cc
	(get_keyfile): Use iterator ranges, rather than whole containers,
	when calling keyfile::set_list_value.
	(set_keyfile): Reindent.

	* schroot/sbuild-chroot.cc
	(get_keyfile): Use iterator ranges, rather than whole containers,
	when calling keyfile::set_list_value.
	(set_keyfile): Reindent.

	* schroot/sbuild-keyfile.h
	(get_list_value): Templated on container type only; the value_type
	is no longer a template parameter.  generic_value is used for the
	type conversion.
	(set_list_value: A range specified by iterators is used, rather
	than the whole container.

	* schroot/sbuild-parse-value.h: Add a new generic_value class to
	wrap type conversions from strings.

	* schroot/sbuild-format-detail.h: Move templated operator<<
	methods outside the class definition.  Make format_details inline.

2006-04-08  Roger Leigh  <rleigh@debian.org>

	* schroot/Makefile.am
	(sbuild_public_h_sources): Add sbuild-format-detail.h

	* schroot/sbuild.h: Include sbuild-format-detail.h.

	* schroot/sbuild-chroot.h: Remove sbuild::chroot::format_detail.

	* schroot/sbuild-format-detail.h: New class,
	sbuild::format_detail, moved from sbuild::chroot::format_detail.

2006-04-08  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-keyfile.h: Use Boost if TR1 is not available.

	* schroot/sbuild-chroot.h: Use Boost if TR1 is not available.

	* schroot/sbuild-auth.h: Use Boost if TR1 is not available.

	* schroot/Makefile.am:
	(AM_CXXFLAGS): Remove -Wextra.
	(BUILT_SOURCES): Don't build sbuild.gch.
	(#CLEANFILES): Don't clean sbuild.gch.
	(nodist_libsbuild_la_SOURCES): Add sbuild-config.h.

	* configure.ac: Add a new header, schroot/sbuild-config.h.  Add
	header checks for tr1/memory, boost/shared_ptr.hpp, tr1/tuple and
	boost/tuple/tuple.hpp.

2006-04-07  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Close #361108.

	* debian/README.Debian: Move chroot safety advice to README.

2006-04-07  Roger Leigh  <rleigh@debian.org>

	* configure.ac: Bump version to 0.2.9.

	* NEWS: Bump version to 0.2.9.

	* debian/changelog: Bump version to 0.2.9-1.

2006-04-07  Roger Leigh  <rleigh@debian.org>

	* po/vi.po: Update.

2006-03-19  Roger Leigh  <rleigh@debian.org>

	* Version 0.2.8.

	* debian/changelog: Update for 0.2.8.

2006-03-18  Roger Leigh  <rleigh@debian.org>

	* configure.ac: Bump version to 0.2.8.

	* NEWS: Bump version to 0.2.8.

	* debian/changelog: Bump version to 0.2.8-1.

2006-03-18  Roger Leigh  <rleigh@debian.org>

	* po/vi.po: Update.

	* po/sv.po: Update.

2006-03-18  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.cc (run_child): Don't fix up argv for a
	login shell if using a command-prefix, since this will not be a
	valid command for command-prefix to execute.

2006-03-08  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Version 0.2.7-2, released to fix a dchroot
	crash.

	* schroot/dchroot-session.cc
	(run_impl): Correctly chain up to the base class.

2006-03-08  Roger Leigh  <rleigh@debian.org>

	* Version 0.2.7.

	* debian/changelog: Update for 0.2.7.

	* NEWS: Update for 0.2.7.

2006-03-07  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Bump version to 0.2.7.

	* NEWS: Bump version to 0.2.7.

	* configure.ac: Bump version to 0.2.7.

	* po/en_GB.po: Update translation.

	* schroot/sbuild-auth.cc
	(setupenv): For security, PATH is always set to a sane state for
	root, but only set in other cases if not preserving the
	environment.

	* schroot/sbuild-session.cc
	(run_child): When "command-prefix" has been specified, correctly
	set the filename to pass to execve.  Mark four strings for
	translation.

2006-03-06  Roger Leigh  <rleigh@debian.org>

	* Version 0.2.6.

	* debian/changelog: Update for 0.2.6.

2006-03-06  Roger Leigh  <rleigh@debian.org>

	* po/en_GB.po: Update translation.

2006-03-06  Roger Leigh  <rleigh@debian.org>

	* TODO: Update.

	* schroot/schroot.conf.5.in: Document required ownership and
	permissions for file archives.

	* schroot/sbuild-chroot-file.cc
	(setup_lock): Check ownership and permissions of file archive.

	* schroot/sbuild-chroot-config.cc (check_security): Tidy error
	message formatting.

	* schroot/setup/10mount:
	(do_umount): Only umount if the mountpoint exists.

	* schroot/setup/05file:
	(repack_file): Preserve ownership and permissions of the original
	archive file.

2006-03-06  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.1.in: Document environment sanitising.

	* schroot/schroot.cc
	(main): Allow the environment to be preserved even if changing
	users.

	* schroot/sbuild-auth.cc
	(setupenv): Add SHELL to default environment.  Sanitise the
	environment by removing dangerous variables (the same set used by
	sudo).

2006-03-06  Roger Leigh  <rleigh@debian.org>

	* po/sv.po: Updated translated from the Free Translation Project.

2006-03-02  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Close #354780.

	* schroot/setup/05file: If the chroot status is not "ok", don't
	repack the file archive.

	* schroot/schroot-setup.5.in: Document second argument to setup
	and exec scripts (chroot status).

	* schroot/schroot.cc (main): Save and restore termios, so that
	abnormal session termination leaves the terminal in a usable
	state.

	* schroot/sbuild-session.cc
	(sighup_called): New variable to flag SIGHUP.
	(sighup_handler): New function to handle SIGHUP.
	(run_impl): Enable and disable handler for SIGHUP.  Switch
	chroot::SETUP_STOP action to after the catch block, to prevent it
	being run twice on failure.
	(setup_chroot): Set chroot_status to false on failure.  Use this
	as the second argument to setup and exec scripts.  If chroot
	locking fails, immediately unlock to ensure that any session
	metadata files are unlinked.
	(wait_for_child): If SIGHUP is caught, kill any child process and
	throw an error.
	(set_sighup_handler): Set a handler for SIGHUP.
	(clear_sighup_handler): Restore the previous handler for SIGHUP.

	* schroot/sbuild-session.h
	(chroot_status): New member to track the state of the chroot.
	(saved_signals): New member used to save and restore signals
	handlers.

2006-02-28  Roger Leigh  <rleigh@debian.org>

	* NEWS: Document new source chroots and file repacking.

	* schroot/schroot-setup.5.in: Document CHROOT_FILE_REPACK.

	* schroot/schroot.conf.5.in: Document source chroot options.

2006-02-28  Roger Leigh  <rleigh@debian.org>

	* schroot/setup/05file:
	(unpack_file): Use a temporary file to prevent data loss, and use
	trap to clean up on failure.

2006-02-28  Roger Leigh  <rleigh@debian.org>

	* schroot/setup/05file:
	(check_filetype): Correctly escape '.'.

2006-02-28  Roger Leigh  <rleigh@debian.org>

	* schroot/setup/05file: Fix incorrect comment.

2006-02-28  Roger Leigh  <rleigh@debian.org>

	* schroot/setup/05file: Run check_filetype in all cases.
	(unpack_file): Correctly unpack tar.bz2 files.
	(repack_file): New function to pack up the chroot tree back into
	an archive file.

2006-02-28  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-environment.h
	(add): Use std::boolalpha to correctly represent boolean values.

2006-02-28  Roger Leigh  <rleigh@debian.org>

	* schroot/exec/00check: Add check for CHROOT_FILE_REPACK.

	* schroot/setup/00check: Add check for CHROOT_FILE_REPACK.

	* schroot/sbuild-chroot-file.cc:
	(chroot_file): repack member is false by default.
	(clone_source): Create a chroot_block_device source chroot.  Set
	repack to true.
	(setup_env): Chain up to chroot_source method.  Add a
	CHROOT_FILE_REPACK environment variable.
	(print_details): Chain up to chroot_source method.
	(get_keyfile): Chain up to chroot_source method.  Set a
	"file-repack" key.
	(set_keyfile): Chain up to chroot_source method.  Get a
	"file-repack" key, but only when restoring an active session.

	* schroot/sbuild-chroot-file.h: Derive from sbuild::chroot_source,
	 and implement sbuild::chroot_source::clone_source.
	(repack): New member to allow repacking of the chroot on session
	ending.

	* schroot/sbuild-chroot-config.cc (parse_data): Remove unneeded
	dynamic_cast to chroot_lvm_snapshot *.  Make sure source chroot is
	valid before adding it.

2006-02-28  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot-config.cc
	(parse_data): Remove special case for lvm-snapshot chroots.
	Instead, create and add a source chroot for any inactive chroot
	implementing chroot_source.

	* schroot/sbuild-chroot-lvm-snapshot.cc
	(clone_source): Create a chroot_block_device source chroot.
	(setup_env): Chain up to chroot_source method.
	(print_details): Chain up to chroot_source method.
	(get_keyfile): Chain up to chroot_source method.
	(set_keyfile): Chain up to chroot_source method.

	* schroot/sbuild-chroot-lvm-snapshot.h: Derive from
	sbuild::chroot_source, and implement
	sbuild::chroot_source::clone_source.

2006-02-28  Roger Leigh  <rleigh@debian.org>

	* All classes derived from sbuild::chroot use virtual public
	inheritance (to allow for the use of sbuild::chroot_source).

2006-02-28  Roger Leigh  <rleigh@debian.org>

	* Makefile.am: Add sbuild-chroot-source.(cc|h).

	* schroot/sbuild.h: Include sbuild-chroot-source.h.

	* schroot/sbuild-chroot-source.(cc|h): New file.  This is an
	interface class, to be implemented by chroots providing source
	chroots in addition to normal chroots.

2006-02-28  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Update.

	* debian/schroot.init: Rename $DAEMON to $SCHROOT.  Don't exit
	with an error if session recovery for an individual chroot fails.

2006-02-28  Roger Leigh  <rleigh@debian.org>

	* NEWS: Document changed behaviour of session operations.

	* schroot/schroot-options.cc (options): Allow session recovery,
	session running and session ending to be performed upon multiple
	chroots, rather than one at once.

2006-02-28  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot-config.cc (parse_data): Don't create a
	"-source" chroot for LVM snapshots if the chroot is active.

2006-02-28  Roger Leigh  <rleigh@debian.org>

	* NEWS: Document exec.d and run-exec-scripts changes.

2006-02-28  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Update.

	* debian/postinst: Move /etc/schroot/run.d/00check to
	/etc/schroot/exec.d/00check if modified locally.

	* debian/preinst: Remove /etc/schroot/run.d/00check if not
	modified locally.

	* Update tests.

	* schroot/schroot.conf: Rename run-session-scripts to
	run-exec-scripts.

	* schroot/schroot.conf.5.in: Document new configuration
	parameters, and deprecated parameters.

	* schroot/schroot.1.in: Document new setup script locations.

	* schroot/schroot-setup.5.in: Document new setup script locations
	and parameters.

	* schroot/Makefile.am (SUBDIRS): Rename run to exec.

	* configure.ac: Rename SCHROOT_CONF_RUN_D to SCHROOT_CONF_EXEC_D.
	Rename schroot/run/Makefile to schroot/exec/Makefile.  Tidy
	comments.

	* schroot/sbuild-session.cc: Use new chroot functions and enums.
	Also use SCHROOT_CONF_EXEC_D rather than SCHROOT_CONF_RUN_D.
	Execution scripts are called with "exec-start" and "exec-stop",
	rather than "run-start: and "run-stop", respectively.

	* Use new functions and enums in all derived chroot types.

	* schroot/sbuild-chroot.cc
	(get_run_exec_scripts): Rename from get_run_session_scripts.
	(set_run_exec_scripts): Rename from set_run_session_scripts.
	(print_details): Print "Run Execution Scripts" rather than "Run
	Session Scripts".
	(get_keyfile): Set "run-exec-scripts" in the keyfile.
	(set_keyfile): Get "run-exec-scripts" in the keyfile.  Also get
	"run-session-scripts" (now deprecated) for backward compatibility.

	* schroot/sbuild-chroot.h
	(setup_type): Rename RUN_START and RUN_STOP to EXEC_START and
	EXEC_STOP.
	(run_exec_scripts): Rename member from run_session_scripts.

	* Rename schroot/run to schroot/exec.

2006-02-27  Roger Leigh  <rleigh@debian.org>

	* debian/postinst: Move /etc/schroot/run.d/50sbuild to
	/etc/schroot/setup.d/50sbuild if modified locally.

	* debian/preinst: Remove /etc/schroot/run.d/50sbuild if not
	modified locally.

	* schroot/schroot-setup.5.in: Update location of 50sbuild.

	* Move 50sbuild from schroot/run.d to schroot/setup.d.

	* schroot/setup/50sbuild: Move from schroot/run/50sbuild.

2006-02-27  Roger Leigh  <rleigh@debian.org>

	* configure.ac: Bump version to 0.2.6.

2006-02-27  Roger Leigh  <rleigh@debian.org>

	* NEWS: Document "command-prefix" option.

	* schroot/schroot.conf.5.in: Document "command-prefix" option.

	* schroot/sbuild-session.cc
	(run_child): Concatenate command_prefix and command to get the
	command to run in the chroot.

	* schroot/sbuild-chroot.cc
	(get_command_prefix): New method to get command prefix.
	(set_command_prefix): New method to set command prefix.
	(print_details): Display command_prefix if set.
	(get_keyfile): Set command-prefix in keyfile.
	(set_keyfile): Get command-prefix from keyfile.

	* schroot/sbuild-chroot.h: New member command_prefix.

2006-02-27  Roger Leigh  <rleigh@debian.org>

	* Remove bashisms in all setup and run shell scripts (test "-o"
	and "function" in shell functions).  Thanks to Clint Adams for
	this patch.

2006-02-26  Roger Leigh  <rleigh@debian.org>

	* Version 0.2.5.

	* configure.ac: Update for 0.2.5.

	* debian/changelog: Update for 0.2.5.

	* NEWS: Document "Path" line.  Update for 0.2.5.

	* schroot/sbuild-chroot.cc (print_details): Output path
	information if available.

2006-02-26  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Update to close the --help options (Bug
	#354477).

2006-02-26  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Update.

	* schroot/run/50sbuild: Create
	${CHROOT_PATH}/var/lib/sbuild/srcdep-lock and set ownership and
	permissions of all files under ${CHROOT_PATH}/var/lib/sbuild to
	root:sbuild and 02775, respectively.  Thanks to Adeodato Sim√≥ for
	this patch.

2006-02-26  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.1.in: Correct the --help options.  Thanks to
	Clint Adams for this patch.

2006-02-25  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Add acknowledgement for #354257.

2006-02-25  Roger Leigh  <rleigh@debian.org>

	* Version 0.2.4.

	* debian/changelog: Update for 0.2.4.

	* TODO: Update.

2006-02-25  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot-config.h: Fix Doxygen warnings.

	* schroot/sbuild-parse-value.cc: Fix Doxygen warnings.

	* schroot/sbuild-parse-value.h: Fix Doxygen warnings.

2006-02-25  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Update.

	* NEWS: Update.

	* Update tests.

	* schroot/schroot.conf.5.in: Document "run-setup-scripts"
	behaviour for plain chroots.

	* schroot/setup/10mount: Allow plain chroots to run the mount
	script.  For plain chroots, bind mount LOCATION on MOUNT_LOCATION.

	* schroot/setup/00check: For plain chroots, verify
	CHROOT_LOCATION, rather than CHROOT_PATH (because CHROOT_PATH does
	not exist at this point).

	* schroot/sbuild-session.cc
	(run_impl): In addition to all other chroot types, if chroot is a
	chroot_plain chroot with setup scripts enabled, set the mount
	location to the session id.

	* schroot/sbuild-chroot-plain.cc
	(get_path): New virtual method to override base class
	implementation.  When setup scripts are enabled, return the mount
	location, or else the location.
	(setup_lock): When setup scripts are enabled, write out a session
	metadata.
	(get_session_flags): When setup scripts are enabled, enable
	SESSION_CREATE, or else 0.

2006-02-24  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.conf.5.in: Document "location" for block-device
	chroots.

	* schroot/schroot-setup.5.in: Document CHROOT_LOCATION and
	CHROOT_PATH.

	* Update tests to check CHROOT_LOCATION and CHROOT_PATH.

	* schroot/setup/50chrootname: Replace CHROOT_MOUNT_LOCATION with
	CHROOT_PATH.

	* schroot/setup/30passwd: Replace CHROOT_MOUNT_LOCATION with
	CHROOT_PATH.

	* schroot/setup/20network: Replace CHROOT_MOUNT_LOCATION with
	CHROOT_PATH.

	* schroot/setup/10mount: Replace CHROOT_MOUNT_LOCATION with
	CHROOT_PATH.

	* schroot/setup/00check: Add CHROOT_LOCATION and CHROOT_PATH.
	Replace CHROOT_MOUNT_LOCATION with CHROOT_PATH.

	* schroot/run/50sbuild: Replace CHROOT_MOUNT_LOCATION with
	CHROOT_PATH.

	* schroot/run/00check: Add CHROOT_LOCATION and CHROOT_PATH.

	* schroot/sbuild-chroot-config.cc
	(print_chroot_location): Use get_path() instead of
	get_mount_location().

	* schroot/sbuild-session.cc
	(run_child): Use get_path() instead of get_mount_location().

	* schroot/sbuild-chroot-plain.cc
	(get_location): Chain up to base class implementation.
	(set_location): Chain up to base class implementation.
	(print_details): Remove printing of location detail.

	* schroot/sbuild-chroot-plain.h
	(get_location): Make virtual.
	(set_location): Make virtual.
	(get_mount_location): Remove virtual function.
	(location): Remove member.

	* schroot/sbuild-chroot-block-device.cc
	(get_location): New method.  Get the location of a chroot on the
	device filesystem.
	(set_location): New method.  Set the location of a chroot on the
	device filesystem.
	(get_keyfile): Set location in keyfile.
	(set_keyfile): Get optional location from keyfile.

	* schroot/sbuild-chroot.cc
	(get_location): New virtual method.
	(set_location): New virtual method.
	(get_path): New virtual method.  The default implementation
	concatenates and returns the mount_location and the location.
	(setup_env): Add CHROOT_LOCATION and CHROOT_PATH to the
	environment.
	(print_details): print Location and Path.

	* schroot/sbuild-chroot.h:
	(location): New member.

2006-02-24  Roger Leigh  <rleigh@debian.org>

	* po/en_GB.po: Add missing space.

2006-02-24  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Bump version to 0.2.4.

	* NEWS: Bump version to 0.2.4.

	* configure.ac: Bump version to 0.2.4.

2006-02-21  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.conf.5.in: Fix typo.

	* schroot/dchroot.1.in: Fix syntax error.

2006-02-21  Roger Leigh  <rleigh@debian.org>

	* schroot/Makefile.am: Install dchroot setuid.

2006-02-21  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Update

	* debian/rules: dchroot must be installed setuid root.

	* debian/schroot.lintian-overrides: Add dchroot.

2006-02-21  Roger Leigh  <rleigh@debian.org>

	* Version 0.2.3.

	* debian/changelog: Update for 0.2.3.

	* NEWS: Document changed "--info" output.

	* TODO: Update.

2006-02-21  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot.cc (print_details): Add a "Session
	Managed" line if SESSION_CREATE is used.

2006-02-21  Roger Leigh  <rleigh@debian.org>

	* test/sbuild-chroot-config.cc: Account for additional -source
	chroots.

2006-02-21  Roger Leigh  <rleigh@debian.org>

	* NEWS: Document automatic block-device creation for lvm-snapshot
	chroots.

	* TODO: Remove completed item.

	* schroot/schroot.conf.5.in: Document automatic block-device
	creation for lvm-snapshot chroots.

	* schroot/sbuild-chroot-config.cc (parse_data): Create a
	corresponding block-device chroot for each lvm-snapshot chroot.
	"-source" is appended to the chroot name and its aliases.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* schroot/dchroot.1.in: Document how to remove dchroot.conf.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* schroot/dchroot.1.in: Document reasons why schroot.conf should
	be used in preference to dchroot.conf.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* schroot/dchroot-session.cc (run_impl): Use boost::format rather
	than printf specifiers.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* Update po files.

	* po/POTFILES.in: Add dchroot files.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* .cvsignore: Update for dchroot.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.cc (main): Use ACTION_LOCATION, not
	ACTION_INFO_LOCATION.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Update for version 0.2.3-1.

	* debian/README.Debian: Update dchroot notes.

	* debian/rules (config.status): Add --enable-dchroot to configure,
	to package the dchroot + wrapper.

	* debian/control (schroot): Provide, Conflict and Replace dchroot.
	Enhances sbuild.  Suggest lvm-common for LVM support.  Update
	description.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* NEWS: Add dchroot.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.1.in: Document new --location option.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* TODO: Add dchroot.

	* configure.ac: Create schroot/dchroot.1.

	* schroot/Makefile.am: If --enable-dchroot was used, build and
	install dchroot and dchroot.1.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.h (session): The contructor chroots
	argument is a const reference rather than a value.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* schroot/dchroot.1.in: Add manual page for dchroot.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.cc: If SBUILD_DCHROOT_COMPAT is defined, run in
	dchroot compatibility mode, using the alternate
	dchroot::chroot_config and dchroot::session classes for reading
	the configuration and session handling.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot-options.cc
	(options): Set dchroot_compat if SBUILD_DCHROOT_COMPAT is defined.
	(options): If dchroot_compat is set, use dchroot compatible
	options, otherwise schroot options.

	* schroot/schroot-options.h
	(action_type): New action ACTION_LOCATION to print chroot
	location.
	(chroot_path): New member; chroot to print path.
	(dchroot_compat): New member; dchroot compatibility mode.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* schroot/dchroot-session.(cc|h): New class, dchroot::session,
	derived from sbuild::session.  This disables user authentication
	(but not authorisation), and disables user switching.

	* schroot/dchroot-chroot-config.(cc|h): New class,
	dchroot::chroot_config, derived from sbuild::chroot_config.  This
	parses the dchroot.conf configuration file.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* configure.ac: Add --enable-dchroot check to enable dchroot
	compatibility.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.cc (main): Use the new session::ptr typedef.

	* schroot/sbuild-session.h: Add a ptr typedef, a shared_ptr to a
	session.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot-config.cc
	(print_chroot_list_simple): New function to print the chroot list
	on a single line, in the same style as dchroot (comma-separated,
	with aliases in square brackets).
	(print_chroot_location): New function to print the mount location
	of the specified chroots.

2006-02-20  Roger Leigh  <rleigh@debian.org>

	* po/Makevars (XGETTEXT_OPTIONS): Add --boost so boost-format
	strings are correctly extracted.

2006-02-18  Roger Leigh  <rleigh@debian.org>

	* Updated sv.po and vi.po from the Free Translation Project.

2006-02-18  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot-config.h: Fix include guard naming.

	* schroot/sbuild-chroot-config.cc (add): New overloaded protected
	method to add a chroot, including checking for duplicates.  Split
	out from parse_data.

2006-02-17  Roger Leigh  <rleigh@debian.org>

	* test/sbuild-chroot-config.cc: Update tests.

	* schroot/schroot.cc
	(main): Use new chroot_config typedef, and use chroot_config::add
	instead of add_config_file and add_config_directory.

	* schroot/sbuild-chroot-config.h
	(ptr): New typedef for a shared_ptr to a chroot_config.
	(add_config_file: Now private.
	(add_config_directory): Now private.

	* schroot/sbuild-chroot-config.cc
	(add): New method.  This replaces the file/directory detection in
	the constructor, and then calls add_config_file or
	add_config_directory as required.
	(load_data): New function, renamed from load.
	(parse_data): New virtual function, called from load_data.  This
	parses the loaded data, and is split out from load.

2006-02-16  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.cc (main): If --quiet is specified, don't log an
	error if the session fails.  A non-zero exit status is still
	returned.

2006-02-16  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.cc (run_child): If it is not possible to
	change into the correct directory inside the chroot, print a
	warning rather than an error.

2006-02-07  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Bump version to 0.2.3.

	* debian/control (Build-Depends): Add pkg-config build dependency.

	* NEWS: Bump version to 0.2.3.

	* configure.ac: Bump version to 0.2.3.

2006-02-07  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot-setup.5.in: Document setup/05file.

	* schroot/schroot.1.in: Fix typo in macro.

2006-02-07  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot-options.cc
	(options): Fix typo (begining).  Thanks to Clytie Siddall at the
	Free Translation Project for spotting it.

2006-02-06  Roger Leigh  <rleigh@debian.org>

	* Version 0.2.2.

	* debian/changelog: Update for 0.2.2.

2006-02-06  Roger Leigh  <rleigh@debian.org>

	* po/en_GB.po: Update.

	* po/POTFILES.in: Update file list.

	* Minor cosmetic cleanups.

2006-02-06  Roger Leigh  <rleigh@debian.org>

	* Remove static qualifer from functions in the unnamed namespace.

	* schroot/sbuild-chroot-config.cc
	(chroot_alphashort): Move to unnamed namespace.

	* Update doxygen documentation for file members.

2006-02-06  Roger Leigh  <rleigh@debian.org>

	* Use the same indentation style for all function prototypes.

2006-02-06  Roger Leigh  <rleigh@debian.org>

	* NEWS: Document updated defaults.

	* schroot/schroot.conf.5.in: Document updated defaults.

	* schroot/sbuild-chroot-lvm-snapshot.cc
	(chroot_lvm_snapshot): Default to running setup and session
	scripts.

	* schroot/sbuild-chroot-file.cc
	(chroot_file): Default to running setup and session scripts.

2006-02-06  Roger Leigh  <rleigh@debian.org>

	* debian/control: Add versioned depends on libpam0g-dev >=
	0.79-3.1, because earlier versions have broken headers, due to
	redefining internal glibc/libstdc++ types.

2006-02-06  Roger Leigh  <rleigh@debian.org>

	* Remove all keyfile constructors from sbuild::chroot and derived
	classes.

2006-02-06  Roger Leigh  <rleigh@debian.org>

	* doc/schroot.dox.in: Strip the build directory from file
	pathnames, use built-in STL support, and sort classes by
	namespace.

2006-02-06  Roger Leigh  <rleigh@debian.org>

	* Rename sbuild::chroot::chroot_ptr to sbuild::chroot::ptr,
	sbuild::chroot::SetupType to sbuild::chroot::setup_type, and
	sbuild::chroot::SessionFlags to sbuild::chroot::session_flags.

2006-02-06  Roger Leigh  <rleigh@debian.org>

	* Rename schroot::Options to schroot::options.

2006-02-06  Roger Leigh  <rleigh@debian.org>

	* Rename sbuild::Session to sbuild::session.

2006-02-06  Roger Leigh  <rleigh@debian.org>

	* Rename sbuild::AuthConvTty to sbuild::auth_conv_tty.

	* Rename sbuild::AuthConv to sbuild::auth_conv.

2006-02-06  Roger Leigh  <rleigh@debian.org>

	* Rename sbuild::AuthMessage to sbuild::auth_message.

2006-02-06  Roger Leigh  <rleigh@debian.org>

	* Rename sbuild::Auth to sbuild::auth.

2006-02-05  Roger Leigh  <rleigh@debian.org>

	* Rename sbuild::Lock to sbuild::lock, sbuild::FileLock to
	sbuild::file_lock, and sbuild::DeviceLock to sbuild::device_lock.

2006-02-05  Roger Leigh  <rleigh@debian.org>

	* Rename sbuild-config.(cc|h) to sbuild-chroot-config.(cc|h).

	* Rename sbuild::Config to sbuild::chroot_config.

2006-02-05  Roger Leigh  <rleigh@debian.org>

	* Rename sbuild::ChrootLvmSnapshot to sbuild::chroot_lvm_snapshot.

	* Rename sbuild::ChrootBlockDevice to sbuild::chroot_block_device.

	* Rename sbuild::ChrootFile to sbuild::chroot_file.

	* Rename sbuild::ChrootPlain to sbuild::chroot_plain.

2006-02-05  Roger Leigh  <rleigh@debian.org>

	* Rename sbuild::Chroot to sbuild::chroot.

	* test/config.ex2/sarge
	(run-session-scripts): Remove duplicate line.

2006-02-05  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-auth-conv.h: Add an error exception typedef.

	* schroot/sbuild-auth-conv-tty.cc
	(get_delay): Throw an exception on fatal timeout.  Log a warning
	rather than using std::cerr.
	(read_string): Return a string rather than a pointer to an
	allocated string.  Throw an exception on failure.
	(read_string): Don't print a newline after the prompt message.
	(conversation): Remove all string cleanup code and replace with a
	single exception handler.

2006-02-05  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-keyfile.h
	(operator >>): Linecounting counts from line 1, rather than 0.
	Fix error message capitalisation.  All parsed groups and keys are
	added to a temporary keyfile, which is then assigned to the
	current keyfile, to allow the correct catching of duplicate groups
	and keys.

	* schroot/sbuild-keyfile.cc
	(operator +=): New function.  Add all of the keys in one keyfile
	to another, overwriting keys on the lhs if already present.
	Comments are carried across.
	(operator +): New function.  Add two keyfiles together.

2006-02-05  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.1.in: Add better description for the use of
	"--config".

	* schroot/schroot.conf.5.in: Document localised strings.

	* schroot/sbuild-config.cc (load): Exceptions thrown by keyfile
	parsing are not caught and treated as warnings; they are fatal.

	* schroot/sbuild-chroot.cc (set_keyfile): Get a localised value
	for the "description" key.

	* schroot/sbuild-keyfile.cc (get_locale_string): Add a set of
	overloaded functions to get localised string values.

2006-02-05  Roger Leigh  <rleigh@debian.org>

	* test/sbuild-keyfile.cc: Update.

	* schroot/sbuild-keyfile.h
	(set_value): Overload to provide an optional comment.  Call
	set_group to create nonexistent groups on the fly.
	(set_list_value): Overload to provide an optional comment.
	(operator >>): Parse comments.

	* schroot/sbuild-keyfile.cc
	(set_group): New function to add a group with a comment.
	(get_comment): An overloaded function to get group and item
	comments.
	(print_comment): Split string to print on '\n', and correctly
	reproduce whitespace.

2006-02-02  Roger Leigh  <rleigh@debian.org>

	* NEWS: Update.

2006-02-02  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.1.in: Document new "--config" option.

	* schroot/schroot.cc (main): Print configuration if "--config" is
	specified.

	* schroot/schroot-options.cc: Add "--config" option to set
	ACTION_CONFIG.

	* schroot/schroot-options.h: New action_type enum ACTION_CONFIG.

	* schroot/sbuild-config.cc (print_chroot_config): New function to
	print chroot configuration (keyfile format).

2006-02-02  Roger Leigh  <rleigh@debian.org>

	* Update testcases.

	* schroot/sbuild-config.cc
	(print_chroot_info): Use new chroot streaming to output details to
	an ostream.

	* print_details is protected in all derived classes.

	* schroot/sbuild-chroot.h
	(print_details): Make protected.
	(operator <<): New friend function to output chroot details to an
	ostream.

2006-02-02  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Update.

	* debian/control (Build-Depends): Remove GLib.

	* README: Update build-dependencies.

2006-02-02  Roger Leigh  <rleigh@debian.org>

	* Update TODO list.

	* Update testcases.

	* schroot/sbuild-config.cc (load): Use the new Chroot keyfile
	streaming functionality to initialise chroots.

	* Implement all new virtual functions in Chroot in derived
	classes.

	* Remove all functions removed from Chroot in derived classes.

	* schroot/sbuild-chroot.(cc|h)
	(Chroot): Remove overloaded construction to initialise with a
	keyfile.
	(create): Remove overloaded method for creating from a keyfile.
	(print_config): Remove.
	(get_keyfile): New protected virtual method to serialise a chroot
	to a keyfile.
	(set_keyfile): New protected virtual method to initialise a chroot
	from a keyfile.
	(operator >>): New friend function to stream from a keyfile.
	(operator <<): New friend function to stream to a keyfile.

2006-02-02  Roger Leigh  <rleigh@debian.org>

	* Simplify rethrow in catch blocks.

	* schroot/sbuild-session.cc (run_impl): Remove unneeded else
	block, to simplify the code.

2006-02-01  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Update version to 0.2.2.

	* NEWS: Update version to 0.2.2.

	* configure.ac: Update version to 0.2.2.

2006-02-01  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot.cc
	(Chroot): Get "mount-location" and "mount-device" from session
	keyfiles.
	(print_details): Use the correct virtual functions to get
	"Mount Location" and "Mount Device".
	(print_config): Use the correct virtual functions to get
	"mount-location" and "mount-device".

2006-02-01  Roger Leigh  <rleigh@debian.org>

	* Version 0.2.1.

	* debian/changelog: Update for 0.2.1.

	* schroot/sbuild-session.cc (wait_for_child): Set child_status to
	EXIT_FAILURE, rather than this->child_status.  This prevents a
	non-zero exit status being returned at all times by child
	processes.

	* NEWS: Update for 0.2.1.

	* configure.ac: Update version to 0.2.1.

2006-01-30  Roger Leigh  <rleigh@debian.org>

	* Version 0.2.0.

	* schroot/schroot.conf.5.in: Add example for file chroot.

	* test/config.ex2/config: Removed (duplicated in
	test/config.ex2/sarge).

	* test/config.ex2/file: New file.  Test data for file chroots.

2006-01-30  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot-options.cc: Beginning a session only works with
	normal chroots.  Session operations on active sessions load all
	chroots, not just session chroots.

	* schroot/sbuild-session.cc
	(run_impl): For persistent sessions, remove aliases prior to
	writing out the session data, to prevent duplicate aliases.
	(run_impl): Only run a command when performing the appropriate
	operations, rather than all the time.
	(setup_chroot): Correct bug in automatic operation which would
	potentially prevent correct cleanup.

	* schroot/sbuild-keyfile.h: Add TODO item for duplicate keys.

	* schroot/sbuild-config.cc (load): Add warnings when chroots and
	aliases names are duplicated.

2006-01-29  Roger Leigh  <rleigh@debian.org>

	* test/sbuild-chroot-file.cc: New file.  Unit test for ChrootFile.

	* schroot/sbuild-util.cc (string_list_to_strv): New function,
	moved from sbuild-session.cc.

	* schroot/sbuild-session.cc: Remove string functions.

2006-01-29  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot.cc (create): Add support for "file" type
	chroots.

	* schroot/setup/05file: Split file type checking and unpacking
	into shell functions.

	* schroot/run/00check: Add support for file chroots.

	* schroot/setup/00check: Add support for file chroots.

	* schroot/setup/Makefile.am (setup_SCRIPTS): Add 05file.

	* schroot/schroot.1.in: Update help options.

2006-01-29  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-util.cc (find_program_in_path): Return the
	program name without the absolute prefix.

	* schroot/sbuild-session.cc (run_child): Don't prefix the program
	search path (find_program_in_path), because it's already running
	inside the chroot.

	* schroot/Makefile.am (DEFS): Remove G_LOG_DOMAIN.

	* schroot/schroot-options.cc: Remove debugging messages.

2006-01-28  Roger Leigh  <rleigh@debian.org>

	* debian/rules: Don't run the testsuite.

2006-01-28  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot-options.cc: Store positional arguments correctly
	using positional_options_description.

2006-01-28  Roger Leigh  <rleigh@debian.org>

	* debian/rules: Don't run the testsuite, due to it requiring root,
	or fake root, privileges.

2006-01-28  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Update for 0.2.0.

	* debian/control: Suggest unzip.

	* NEWS: Update for 0.2.0.

2006-01-28  Roger Leigh  <rleigh@debian.org>

	* po/en_GB.po: Updated British English translation.

2006-01-28  Roger Leigh  <rleigh@debian.org>

	* configure.ac: Remove check for stdbool.h.

2006-01-28  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot.h: setup_session_info is protected and
	virtual.

	* test/Makefile.am: Distribute test data.

2006-01-28  Roger Leigh  <rleigh@debian.org>

	* schroot/setup/05file: Filetype checks are now quiet.

2006-01-28  Roger Leigh  <rleigh@debian.org>

	* Update documentation.

	* schroot/setup/10mount: Add special cases for file chroots.

	* schroot/setup/05file: New file for unpacking and deleting
	file-based chroots.

	* schroot/sbuild-chroot-file.(cc|h): New file implementing
	file-based chroots.

	* schroot/sbuild-chroot.cc (setup_session_info): Add
	setup_session_info from ChrootLvmSnapshot.

	* schroot/sbuild-chroot-lvm-snapshot.cc: Remove setup_session_info.

2006-01-28  Roger Leigh  <rleigh@debian.org>

	* test/sbuild-parse-value.cc: New file.  Tests for parse_value.

	* schroot/sbuild-parse-value.h (parse_value): Check failbit rather
	than badbit to catch parse errors.

	* schroot/sbuild-parse-value.cc (parse_value): Correctly parse
	false boolean values.

2006-01-28  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.cc (run_child): Search for the program to
	run inside the chroot, rather than on the root filesystem.

	* schroot/sbuild-util.cc (find_program_in_path): Add a prefix
	argument, to allow searching in non-root paths, for example inside
	a chroot.

2006-01-28  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-config.cc (load): Catch and handle exceptions if
	chroot creation fails.

	* schroot/sbuild-chroot.cc (create): Throw an exception if
	creation fails.

2006-01-28  Roger Leigh  <rleigh@debian.org>

	* configure.ac: Update maintainer email address.

	* schroot/sbuild-config.h: Remove completed TODO item.

2006-01-27  Roger Leigh  <rleigh@debian.org>

	* test/sbuild-config.cc (class test_config): Update to use active
	argument.

	* schroot/schroot.cc (main): When loading chroot configuration,
	specify if they are active sessions or not.

	* schroot/sbuild-config.cc: All methods taking a file or directory
	name also take an "active" argument to specify if the chroots
	being loaded are active sessions or not.

2006-01-27  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-environment.h: Remove completed TODO item about
	recommending strv_delete().

2006-01-27  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-auth-conv-tty.cc: Move static data and functions
	into the unnamed namespace.

2006-01-26  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.cc (main): Only allow preservation of the user
	environment if not switching users.

	* schroot/sbuild-auth.cc (Auth, set_user): Throw exceptions rather
	than exiting on failure.
	(setupenv): Tidy up setting the environment.

2006-01-26  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-auth.cc
	(~Auth): Shut down PAM if currently active.

2006-01-26  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-keyfile.cc
	(check_priority): Add support for PRIORITY_DISALLOWED.

	* schroot/sbuild-config.cc: Convert to throw exception instead of
	immediately terminating with an error.  This makes unit testing
	possible, and errors are all caught correctly at the top-level.

	* schroot/sbuild-chroot-lvm-snapshot.cc: When reading a keyfile,
	only allow reading "lvm-snapshot-device" when restoring an active
	chroot.

	* configure.ac (AM_INIT_AUTOMAKE): Quote argument.

	* test/sbuild-config.cc: New file.  Test for sbuild::Config.

2006-01-16  Roger Leigh  <rleigh@debian.org>

	* po/vi.po: Add Vietnamese translation.

2006-01-13  Roger Leigh  <rleigh@debian.org>

	* test/sbuild-log.cc: New file.  Test logging with stringbufs.

	* test/sbuild-nostream.cc (test_nostream): Fix whitespace.

2006-01-13  Roger Leigh  <rleigh@debian.org>

	* test/sbuild-nostream.cc: New file.  Test for nostream.

	* test/sbuild-environment.cc (add_simple_examples): Correct
	assertion.

2006-01-12  Roger Leigh  <rleigh@debian.org>

	* test/sbuild-lock.cc: New file.  Tests for locking.

	* schroot/sbuild-lock.cc (set_lock): If the current process
	doesn't own the lock, unlocking always succeeds.

2006-01-12  Roger Leigh  <rleigh@debian.org>

	* test/sbuild-keyfile.cc: New file.  Tests for keyfile.

	* schroot/sbuild-keyfile.h
	(set_value): Insert stringstream value, rather than templated
	value.
	(set_list_value): Fix bug with iterator by using binary operator +
	rather than +=.
	(operator <<): Print newline after key-value pairs.

	* schroot/sbuild-keyfile.cc
	(keyfile): Add constructor taking no arguments.
	(print_comment:	Turn into static member function.

2006-01-11  Roger Leigh  <rleigh@debian.org>

	* test/sbuild-environment.cc: New file.  Tests for environment.

	* test/testmain.cc (main): Add debugging checks.

	* test/Makefile.am (libtest_la_LIBADD): Add libsbuild.la, and
	remove from all binary LDADD lines.

	* schroot/sbuild-util.cc (strv_delete): New function moved from
	sbuild-session.cc, with the iterator type corrected.

	* schroot/sbuild-session.cc: Remove strv_delete.

	* schroot/sbuild-environment.h: Fix constness of overloaded
	operators, and correct use of lvalue in binary operators.

2006-01-11  Roger Leigh  <rleigh@debian.org>

	* Remove completed and obsolete TODO items.

	* test/sbuild-util.cc: Update testcase with fixed path.

	* schroot/sbuild-session.cc (run_child): Use new
	find_program_in_path syntax.

	* schroot/sbuild-util.cc (find_program_in_path): Add path
	argument, to allow use of paths other than $PATH.

2006-01-08  Roger Leigh  <rleigh@debian.org>

	* Update API reference.

	* test/sbuild-chroot-lvm-snapshot.cc: New file.  Tests for
	ChrootLvmSnapshot.

	* test/sbuild-chroot-block-device.cc: New file.  Tests for
	ChrootBlockDevice.

	* test/sbuild-chroot-plain.cc: New file. Tests for ChrootPlain.

	* test/test-sbuild-chroot.h: New file.  Base class for all chroot
	tests.

	* test/test-helpers.h (test_list): New file of test helper
	functions.  The initial function is a templated test for testing
	string_list getters and setters.

	* test/Makefile.am (noinst_LTLIBRARIES): Add libtest.la, a generic
	test library that contains the generic test runner and links with
	CppUnit.

	* schroot/sbuild-keyfile.h: Remove parse_value.

	* schroot/sbuild-environment.h (get): Use parse_value to parse
	values.

	* schroot/sbuild-parse-value.(cc|h): New files.  Split value
	parsing out from sbuild-keyfile to allow reuse.

2006-01-07  Roger Leigh  <rleigh@debian.org>

	* po/sv.po: Add Swedish translation.

2006-01-07  Roger Leigh  <rleigh@debian.org>

	* Add copyright and GPL boilerplate to all testcase code.

	* test/sbuild-chroot.cc: New testcase for sbuild::Chroot.

	* schroot/sbuild-environment.cc (remove): For the "char **"
	overloaded method, use the correct iterator type (the same as the
	equivalent add function).

	* schroot/sbuild-environment.h (add): Specialise templated method
	for strings.

	* schroot/sbuild-environment.h (get): New templated method to
	retrieve the value of an environment variable by its name.

2006-01-06  Roger Leigh  <rleigh@debian.org>

	* doc/Makefile.am (all-local): Don't rebuild doxygen documentation
	when not in maintainer mode.

	* configure.ac: Enable maintainer mode.

2006-01-06  Roger Leigh  <rleigh@debian.org>

	* doc/Makefile.am (EXTRA_DIST): Distribute schroot-stamp, to
	prevent documentation rebuild.

2006-01-06  Roger Leigh  <rleigh@debian.org>

	* debian/rules: Build and run the testsuite in the build target.

	* debian/control (Build-Depends): Add libcppunit-dev.

	* schroot/sbuild-util.cc
	(find_program_in_path): Split PATH on ':' characters.

	* test/sbuild-util.cc: New file: tests for sbuild-util functions.

	* test/testmain.cc: New file: test runner for all tests.

	* configure.ac: Add check and conditinal for CppUnit.

	* Makefile.am (SUBDIRS): Add test directory.

2006-01-03  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.cc
	(unnamed namespace): Add child_wait variable to allow debugging of
	child processes.
	(get_auth_status): Correct checks for null chroot.
	(run_impl): Correct checks for null chroot.
	(setup_chroot): Call closelog in child before exec.
	(run_child): Remove mount_location assertion, since for some
	chroot types this will fail.
	(run_child): Use command[0] rather than command[1], which may not
	exist.  Call closelog in before exec.
	(run_chroot): Loop on child_wait to allow a debugger to be
	attached to the child, if debugging is enabled.

	* schroot/sbuild-environment.cc (add): Use char ** for iterator
	type, and add additional checks for null.
	(add): Add stricter substring range checks
	(remove): Add stricter substring range checks.

	* schroot/sbuild-chroot.cc

	* schroot/sbuild-chroot-plain.cc
	(ChrootPlain): Move read_keyfile code into the constructor.

	* schroot/sbuild-chroot-lvm-snapshot.cc
	(ChrootLvmSnapshot): Move read_keyfile code into the constructor.

	* schroot/sbuild-chroot-block-device.cc
	(ChrootBlockDevice): Move read_keyfile code into the constructor.

	* schroot/sbuild-chroot.cc
	(Chroot): Move read_keyfile code into the constructor.
	(print_details): Print mount_location and mount_device if set for
	both session and non-session chroots.

2006-01-03  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-auth.cc: Log a warning if construction fails.
	Correct buggy user assertions.

2006-01-02  Roger Leigh  <rleigh@debian.org>

	* Actually commit the new environment class.

2006-01-02  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot-options.cc (Options): Rewrite the checks which
	decide which chroot configuration files should be read, depending
	upon the action specified.

	* schroot/schroot-options.h (all_used): new method to detect if
	any of the --all* options are in effect.

	* schroot/schroot.cc (main): If no chroots are available, warn
	rather than exiting with an error, since for several commands
	there may well not be any chroots defined.

	* schroot/sbuild-config.cc (validate_chroots): Correct inverse
	match which treated all correctly named chroots as being invalid.

2006-01-02  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-types.h: Remove env and env_list typedefs.

	* schroot/sbuild-session.cc: Remove env_list_to_strv helper,
	replaced by environment::get_strv().  Replace setup_env_var
	helper with environment add method.

	* schroot/sbuild-chroot.h: Chroot::setup_env() uses environment
	rather than env_list; derived classes also changed.  Removed
	setup_env_var helper.

	* schroot/sbuild-auth.h: Replace env_list with environment.
	Rename Auth::environment member to user_environment.

	* schroot/sbuild-auth.cc: Remove env_string helper.

	* schroot/sbuild-environment.(cc|h): New class sbuild::environment
	to replace sbuild::env_list and its associated helpers in a number
	of classes.  This is a collection of environment variables.

2006-01-01  Roger Leigh  <rleigh@debian.org>

	* Updated copyright notices to include 2006 changes.

	* schroot/Makefile.am: Generate a sbuild.gch precompiled header,
	and include sbuild.h in all sources which previously included an
	sbuild header.  This should improve compilation speed.

	* Rename schroot.h to sbuild.h, and include all sbuild-*.h
	headers.

	* schroot/sbuild-auth.cc (run): Fix casting to "const void **".

2005-12-31  Roger Leigh  <rleigh@debian.org>

	* schroot/Makefile.am (AM_CXXFLAGS): Add additional warning flags.

	* schroot/sbuild-auth.cc (run): Use a static_cast instead of a
	C-style cast.

	* schroot/sbuild-lock.cc (set_lock): Initialise the l_pid member
	of struct flock.

2005-12-31  Roger Leigh  <rleigh@debian.org>

	* Change all instances of "const T&" to "T const&" for
	consistency.

2005-12-30  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot-lvm-snapshot.cc (setup_session_info):
	Imbue ostream with "C" locale.

	* schroot/sbuild-config.cc (load): Imbue istream with "C" locale.

	* schroot/sbuild-keyfile.cc (keyfile): Imbue ifstream with "C"
	locale.

	* schroot/sbuild-chroot.h (setup_env_var): Imbue stringstream with
	"C" locale.

	* schroot/sbuild-keyfile.h: All stringstreams are imbued with the
	"C" locale for locale-independent formatting.

	* schroot/schroot-releaselock.cc (main): Use C++ locale setup.

	* schroot/schroot.cc (main): Use C++ locale setup.

2005-12-30  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.cc (main): Use actions rather than old bool
	values.  Compute the session operation using the action type.
	Surround the entire function in a try/catch block, so that
	exceptions thrown during program execution are reported nicely.

	* schroot/schroot-options.cc
	(set_action): Only allow one action to be specified.
	(Options): Set the appropriate actions when parsing.  Session
	operations are represented within the action member.

	* schroot/schroot-options.h (schroot): Add action_type enum.  This
	is used to represent all actions the user may specify, rather than
	using a separate bool for each.  Remove the session operation
	member.

2005-12-30  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot-options.h: Fix include guard naming scheme.

	* schroot/schroot-releaselock-options.(cc|h): New class for
	schroot-releaselock options parsing.  The options structure has
	been split out from schroot-releaselock.cc to create this new
	class.

2005-12-30  Roger Leigh  <rleigh@debian.org>

	* Replace all format_detail_* typedef usage with format_details.

	* schroot/sbuild-chroot.h (format_details): Templated member
	function to construct the correct format_details class template.
	This replaces all the format_detail_* typedefs.

2005-12-30  Roger Leigh  <rleigh@debian.org>

	* All code updated to use Chroot::chroot_ptr.

	* schroot/sbuild-config.cc (load): Create chroots from keyfile
	using Chroot::create.

	* schroot/sbuild-chroot.h: Chroots are created by a factory
	function returning a shared_ptr (chroot_ptr).  All chroot types
	have protected constructors, and must be created using the static
	create methods.

2005-12-30  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot.h
	(format_detail::operator <<): Fix justification.

	* schroot/sbuild-chroot.cc (read_keyfile): Set chroot priority.

2005-12-30  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-config.cc (load): Insert chroot name into alias
	map in addition to alias names.

2005-12-30  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot-plain.cc (read_keyfile): Use keyfile
	priorities.

	* schroot/sbuild-chroot-block-device.cc (read_keyfile): Use
	keyfile priorities.

	* schroot/sbuild-chroot.cc (read_keyfile): Set chroot name from
	group name, and use keyfile priorities.

	* schroot/sbuild-keyfile.h
	(parse_value): New templated method to parse a key value and set
	the value of the specified value type.
	(get_value): Use parse_value, and add debugging messages.  Add
	overloaded method to check key priority.
	(get_list_value): Use parse_value.  Add overloaded method to check
	key priority.
	(set_list, set_list_value): Use std::boolalpha to get text
	representation of bool.
	(operator >>): Correct off-by-one errors with substring lengths.

	* schroot/sbuild-keyfile.cc (check_priority): New method to check
	if a key is required, optional, deprecated or obsolete.  Log a
	warning or error message if a key is missing or present when it
	should not be.

	* schroot/sbuild-config.cc
	(Config): Throw error if construction fails.
	(add_config_directory): Correct error message.
	(load): Chroot type defaults to "plain".  Log a warning if the
	chroot type is incorrect.

	* schroot/sbuild-log.cc (log_debug): Report the debug level when
	printing messages.

	* schroot/schroot.cc (main): Set the default debugging level to
	DEBUG_NOTICE.

2005-12-29  Roger Leigh  <rleigh@debian.org>

	* NEWS: Bump version to 2.0

2005-12-29  Roger Leigh  <rleigh@debian.org>

	* doc/schroot.dox.in
	(PROJECT_NUMBER): Use @VERSION@.
	(WARN_LOGFILE): Log to schroot.log.

2005-12-29  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-nostream.h: Rename m_sbuf to nbuf.

2005-12-29  Roger Leigh  <rleigh@debian.org>

	* configure.ac: Bump version to 0.2.0, following the C++ and
	doxygen work.

2005-12-28  Roger Leigh  <rleigh@debian.org>

	* Add doxygen support to configure and doc/Makefile.am, and
	distribute the doxygen-generated documentation.

2005-12-28  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot-options.cc: Always qualify string_list with
	sbuild::.

2005-12-28  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-auth-conv-tty.h: (sbuild::AuthConvTty): Rename
	conversation_impl to conversation.

	* schroot/sbuild-auth-conv.h (sbuild::AuthConv): Remove
	conversation_impl method, replacing it with conversation.

2005-12-28  Roger Leigh  <rleigh@debian.org>

	* Document remaining undocumented functions and typedefs.
	Implementations of pure virtual functions are not documented (a
	doxygen bug, Debian bug #324117).

2005-12-28  Roger Leigh  <rleigh@debian.org>

	* Convert all inline gtk-doc documentation to Doxygen format, and
	move it from the sources into the headers.

2005-12-26  Roger Leigh  <rleigh@debian.org>

	* Convert all classes to use runtime_error_custom, and remove all
	error code enums.

	* schroot/sbuild-error.h: Remove Exception class, and replace with
	a runtime_error base class, and runtime_error_custom<> template
	class (templated on class using it), which no longer has an error
	code member (the error code was a GError holdover which was not
	used).

2005-12-26  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.c:
	(run_impl, setup_chroot): Add mising format strings.

2005-12-26  Roger Leigh  <rleigh@debian.org>

	* Remove typedef'd enums in favour of plain enums.

2005-12-26  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.cc (is_group_member): Use new rather than
	C99 VLAs.
	(setup_chroot): setup_type_string is a std::string, rather than a
	char *.

	* schroot/sbuild-config.cc (validate_chroots): Return bad_chroots.

	* schroot/sbuild-chroot.cc (read_keyfile): Initialise bool values
	to quell compiler warning.

	* schroot/sbuild-auth.h (ErrorCode): Remove trailing comma.

	* schroot/sbuild-auth.cc
	(auth_conv): Use signed rather than unsigned int in for loops.
	(Auth::Auth): Correct member initialisation order.

	* schroot/Makefile.am (AM_CXXFLAGS): Add additional flags: -Wall
	-Wcast-align -Wwrite-strings -pedantic -Wcast-qual
	-Wredundant-decls.

2005-12-25  Roger Leigh  <rleigh@debian.org>

	* configure.ac: Remove checks for Glib.  Glib is now completely
	removed from the sources.

	* schroot/Makefile.am (libsbuild_la_LIBADD): Remove Glib library.

	* schroot/schroot-releaselock.cc: Convert from GOption to
	Boost.Program_options.

	* schroot/schroot-options.cc: Convert from GOption to
	Boost.Program_options.

2005-12-24  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-util.cc: Remove format_string.

	* Convert all uses of sbuild::format_string to boost::format.

	* schroot/sbuild-error.h (sbuild): Add a constructor which gets
	its message from a boost::format, rather than a std::string.

2005-12-24  Roger Leigh  <rleigh@debian.org>

	* debian/control (Build-Depends): Add libboost-dev and
	libboost-program-options.

	* schroot/Makefile.am (libsbuild_la_LIBADD): Add BOOST_LIBS.

	* configure.ac: Add checks for Boost.Format and
	Boost.Program_options headers and shared libraries.

2005-12-23  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.cc:
	(sbuild_session_setup_chroot_child_setup): Remove.
	(setup_chroot): Replace g_spawn_sync with fork(), exec() and
	wait().  The uid, gid and group list are set prior to calling
	exec, as with sbuild_session_setup_chroot_child_setup previously.
	(run_child): Replace g_get_current_dir with GNU libc getcwd, and
	replace g_find_program_in_path with find_program_in_path.
	(wait_for_child): The variable to store the child exit status is
	passed in by reference, rather than being fixed.

	* schroot/sbuild-keyfile.h (keyfile::get_list_value): Use
	split_string instead of get_list_items.

	* schroot/sbuild-keyfile.cc (get_list_items): remove.

	* schroot/sbuild-util.cc
	(split_string): New function to split a string into a string_list,
	based upon sbuild::keyfile::get_list_value, but allows
	specification of a custom split character.  *
	(find_program_in_path): New function to search for an executable
	in $PATH.  A replacement for g_find_program_in_path.


2005-12-22  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot.h (sbuild::Chroot::format_detail):
	template helper class to simplify streaming outout of chroot
	details.  Used by all derived chroot classes.

	* All Glib string functions have been replaced with the C++ or C99
	equivalent.

	* All uses of g_return[_val]_if_fail have been replaced with
	conditionals or static assertions.

	* All Glib logging and message functions have been replaced with
	the new logging functions and standard C++ streams.

	* All Glib types have been completely removed, with the exception
	of one instance of GError, and two uses of GOption.

	* Support for gtk-doc has been disabled and partially removed.

	* The dependency upon libsigc++ has been removed.  Virtual
	functions are used instead, which will provide more safety and
	security.

	* schroot/sbuild-keyfile.(cc|h): New class sbuild::keyfile, a
	replacement for GKeyFile.  Unlike GKeyFile, it uses templated
	methods to allow its use with any streamable type, in a type-safe
	manner.  The existing GKeyFile helper functions have been removed.

	* schroot/sbuild-log.(cc|h): New file: logging functions to
	replace the Glib print and logging utility functions.  Unlike the
	Glib types, these are based around ostreams.

	* schroot/sbuild-nostream.(cc|h): New class sbuild::basic_nostream
	with nostream and wnostream typedefs.  This is a "null ostream",
	which is a bit-bucket stream which discards all input.

	* schroot/sbuild-types.h: New file: commonly-used types.

	* Continue purge of Glib.

2005-12-19  Roger Leigh  <rleigh@debian.org>

	* schroot/Makefile.am: Replace $(GOBJECT_LIBS) with $(GLIB_LIBS).

	* configure.ac: Replace check for GObject with a check for GLib,
	and adjust $SCHROOT_CFLAGS accordingly.

	* Remove GObject support.

2005-12-19  Roger Leigh  <rleigh@debian.org>

	* Replace all use of glib/gi18n.h with sbuild-i18n.h.

	* schroot/sbuild-i18n.h: New file: gettext macros.

2005-12-19  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-auth-conv-tty.cc, sbuild-auth.cc: Add support for
	iostream.

	* Replace most uses of g_strdup_printf with format_string.

	* schroot/sbuild-util.cc (format_string): New function to create a
	std::string from a C-style format string.

2005-12-18  Roger Leigh  <rleigh@debian.org>

	* Remove GLib types (gboolean, gchar, gint), and replace with
	standard C++ types.

2005-12-18  Roger Leigh  <rleigh@debian.org>

	* All typedefs and enums have been moved into the class
	declarations, with the Sbuild and Object prefixes removed.

	* GError error propagation has been replaced with
	sbuild::Exception<> in all code.  The catch blocks are still
	local, simply replacing GError, but this will be fixed up later.

	* All Sbuild objects are in the "sbuild" namespace, and Schroot
	object are in the "schroot" namespace, with the prefix removed
	from the class names.

	* schroot/sbuild-error.h: Remove GError/GType glue, and replace
	with a simple templated exception class derived from
	std::runtime_error, initially to replace GError in a compatible
	manner.

2005-12-17  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-config.cc (load): Add GKeyFile error checking.

	* schroot/sbuild-chroot-lvm-snapshot.cc (read_keyfile): New
	private method to read a GKeyFile.

	* schroot/sbuild-chroot-block-device.cc (read_keyfile): New
	private method to read a GKeyFile.

	* schroot/sbuild-chroot-plain.cc (read_keyfile): New private
	method to read a GKeyFile.

	* schroot/sbuild-chroot.cc (read_keyfile): New private method to
	read a GKeyFile.

	* schroot/sbuild-keyfile.h: New file.  Simple wrapper funtions for
	interfacing with GKeyFile.

2005-12-16  Roger Leigh  <rleigh@debian.org>

	* Convert all sources from GObject-based C to ISO C++.  This
	conversion is not yet complete, but builds without error.

2005-11-07  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Update.

	* debian/schroot.init: Remove "function" bashism.

2005-11-05  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Update.

	* debian/rules (config.status): Use /usr/lib rather than
	${prefix}/lib for libexecdir, to avoid unexpanded shell vars in
	config.h.

2005-11-05  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.c (is_group_member): Don't fail if the
	supplementary group count is 0.  Also check the process' GID in
	addition to the supplementary groups.

2005-11-05  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Update for 0.1.8.

	* NEWS: Update for 0.1.8.

	* configure.ac: Update version to 0.1.8.

2005-11-04  Roger Leigh  <rleigh@debian.org>

	* Version 0.1.7.

	* debian/changelog: Update date.

	* NEWS: Update.

2005-11-04  Roger Leigh  <rleigh@debian.org>

	* TODO: Remove completed items, and update new items.

	* README: Document new build dependencies.

	* schroot/schroot.conf.5.in: Add new chroot options to the examples.

	* schroot/schroot.conf: Add new chroot options to the examples.

	* schroot/schroot-setup.5.in: Document the setup and run scripts.

2005-11-03  Roger Leigh  <rleigh@debian.org>

	* debian/schroot.init: Use --quiet option to suppress an
	unnecessary error message.

	* schroot/schroot.c
	(main): If --quiet is used, don't print an error message if no
	chroots are defined.  Remove check for --quiet and --verbose, now
	moved to schroot_options_parse.

	* schroot/schroot-options.c
	(schroot_options_parse): Check if both --quiet and --verbose have
	been specified.

2005-11-02  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.c
	(sbuild_session_run): Ensure child exit status is set to
	EXIT_FAILURE on session failure.
	(sbuild_session_init): Set child exit status to EXIT_SUCCESS by
	default.

	* debian/changelog: Document changes.

	* debian/rules (binary-arch): Use dh_installinit to install init
	script.

	* debian/schroot.init (NAME): New init script to perform session
	recovery at system startup.

2005-11-02  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot-options.c
	(schroot_options_parse): Don't load all chroot configurations when
	in list mode.

2005-11-02  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.c
	(main): Delegate the decision about which chroot configuration
	files to load to schroot_options_parse.  Use
	sbuild_config_print_chroot_info to print chroot information.

	* schroot/schroot-options.h
	(struct _SchrootOptions): Add load_chroots and load_sessions
	members.

	* schroot/schroot-options.c
	(schroot_options_parse): Determine which chroot configuration
	files to load more accurately.

	* schroot/sbuild-config.c
	(sbuild_config_print_chroot_info): New function, split out from
	main() in schroot.c.

2005-11-01  Roger Leigh  <rleigh@debian.org>

	* Updated documentation.

	* schroot/schroot.c: Update to use the new SchrootOptions option
	parsing:
	(get_chroot_options): An SchrootOptions struct is passed as an
	argument, since the options are no longer global.
	(main): Create and free an SchrootOptions struct.

	* schroot/schroot-options.[ch]: New files.  The command-line
	option parsing has been split out of schroot.c, with an new
	SchrootOptions struct to contain the parsed options.

2005-10-30  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.1.in: Document --recover-session.

	* schroot/setup/*: Add support to setup scripts for
	"setup-recover" option.  In particular, filesystems are all
	remounted, and all "setup-start" tasks are performed, except for
	snapshotting.

	* schroot/schroot.c
	(parse_options): Add "--recover-session" session option.
	(parse_session_options): Parse "--recover-session".
	(main): Update configuration file loading to account for recovery.

	* schroot/sbuild-session.c
	(sbuild_session_setup_chroot): Add support for "setup-recover"
	argument in scripts.
	(sbuild_session_run): Add support for session recovery option.

	* schroot/sbuild-session.h
	(SbuildSessionOperation): Add SBUILD_SESSION_OPERATION_RECOVER.

	* schroot/sbuild-chroot.h
	(SbuildChrootSetupType): Add SBUILD_CHROOT_SETUP_RECOVER.

2005-10-30  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.c
	(main): Allow selection of non-session chroots as sessions, in
	order to allow session-like behaviour for all chroots, even those
	that can't natively support sessions.

	* schroot/sbuild-session.c
	(sbuild_session_run): Don't append a UUID to the session ID if the
	chroot does not support session creation.

2005-10-30  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.c (main): Abort if more than one chroot is
	specified when starting a session.

2005-10-28  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.c
	(parse_options): Remove unused "UUID" argument description for
	running and ending sessions.
	(main): Don't set the session id.

	* schroot/sbuild-session.c
	(sbuild_session_run): If not running or ending a session, generate
	a session ID in the form "chroot_name-uuid".

2005-10-27  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.c
	(sbuild_session_setup_chroot): Propagate GError from
	sbuild_chroot_setup_lock.

	* schroot/sbuild-chroot-lvm-snapshot.c
	(sbuild_chroot_lvm_snapshot_setup_lock): Use GError.  Refactor to
	propagate GError on failure, and reduce the number of return
	points.
	(sbuild_chroot_lvm_snapshot_setup_session_info): New function,
	split out from sbuild_chroot_lvm_snapshot_setup_lock to increase
	readability.

	* schroot/sbuild-chroot-block-device.c
	(sbuild_chroot_block_device_setup_lock): Use GError.  Refactor to
	propagate GError on failure, and reduce the number of return
	points.

	* schroot/sbuild-chroot-plain.c
	(sbuild_chroot_plain_setup_lock): Use GError.

	* schroot/sbuild-chroot.c
	(sbuild_chroot_error_quark): New function.

	* schroot/sbuild-chroot.h
	(SbuildChrootError): Add error enum.
	(SbuildChrootSetupLockFunc): Add a GError.

2005-10-27  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-config.c
	(sbuild_config_clear_chroot_list): New helper function to clear
	stored chroot list.
	(sbuild_config_clear): New function; uses
	sbuild_config_clear_chroot_list.
	(sbuild_config_finalize): Use sbuild_config_clear_chroot_list.

2005-10-23  Roger Leigh  <rleigh@debian.org>

	* TODO: Remove chroot default item.

	* schroot/schroot.1.in: Document default fallback.

	* schroot/schroot.c (get_chroot_options): Fall back to "default"
	chroot if no chroot was specified.

2005-10-23  Roger Leigh  <rleigh@debian.org>

	* po/en_GB.po: Updated translation.

	* TODO: Update.  All locking and session items removed now that
	they are implemented.

	* schroot/schroot.1.in: Document new "--all-chroots" and
	"--all-sessions" options.

	* schroot/schroot.c: Add "--all-chroots" and "--all-sessions"
	command-line options.
	(get_chroot_options): Use new "--all" options.
	(get_chroot_options): Print a list of invalid chroots found during
	chroot validation.
	(main): Create the configuration using sbuild_config_new(), and
	add the approprate configuration and session configuration
	depending on the command-line options used.

	* schroot/sbuild-session.c
	(sbuild_session_run): When restoring a session, set the session ID
	from the chroot name.
	(sbuild_session_run): The session operations are only run if
	specified in the session operations.

	* schroot/sbuild-config.c
	(sbuild_config_new): New function.  This does not load any
	configuration files.
	(sbuild_config_add_config_file): New function, renamed from
	sbuild_config_set_config_file.  This now exported.
	(sbuild_config_add_config_directory): New function, renamed from
	sbuild_config_set_config_directory.  This now exported.
	(sbuild_config_find_generic): Cope with the case that no chroots
	exist.
	(sbuild_config_get_chroot_list): Cope with the case that no
	chroots exist.
	(sbuild_config_validate_chroots): Return a list of invalid chroot
	names, rather than FALSE.
	(sbuild_config_class_init): "config-file" and "config-directory"
	are no longer construct-only.  Both properties are now completely
	virtual, with no corresponding member data (a single filename no
	longer makes sense when multiple configuration files may be added
	at any time).

	* schroot/sbuild-config.h (struct _SbuildConfig): Removed file
	member.

	* schroot/sbuild-chroot.h: Fix function misordering.

	* schroot/sbuild-chroot.c
	(sbuild_chroot_print_config): Print "active" property, don't
	translate any option names, and format "mount-device" correctly.
	(sbuild_chroot_set_property): Add the PROP_ACTIVE property.
	(sbuild_chroot_class_init): Make "active" a construction property;
	this is not documented, as it is not intended for use by users; it
	is for session recovery.

	* schroot/sbuild-chroot-lvm-snapshot.c
	(sbuild_chroot_lvm_snapshot_print_config): Chain up using the
	print_config vfunc.
	(sbuild_chroot_lvm_snapshot_setup_lock): Use
	sbuild_chroot_print_config rather than
	sbuild_chroot_print_details.

2005-10-20  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.c (sbuild_session_run): Set and unset the
	chroot "active" property before and after running a session.

	* schroot/sbuild-config.c (sbuild_config_load): Remove active
	argument from sbuild_chroot_new_from_keyfile call.

	* schroot/sbuild-chroot.c
	(sbuild_chroot_class_init): Make "active" property writable, and
	add methods to get and set the active property.
	(sbuild_chroot_new_from_keyfile): Remove active argument.

2005-10-20  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.c (sbuild_session_run): If a chroot sets
	SBUILD_CHROOT_SESSION_CREATE, update the chroot name with the
	session name.

	* schroot/sbuild-chroot.h (SbuildChrootSessionFlags) Removed
	unused session flags, and renamed SBUILD_CHROOT_SESSION_PERSISTENT
	to SBUILD_CHROOT_SESSION_CREATE.  All chroot types updated to
	reflect the change.

2005-10-20  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.c (sbuild_session_run): For LVM
	snapshots, set the chroot name to the session name.

	* schroot/sbuild-chroot-lvm-snapshot.c
	(sbuild_chroot_lvm_snapshot_setup_lock): Write out a session file
	on session startup, and remove it when stopping the session.

2005-10-18  Roger Leigh  <rleigh@debian.org>

	* debian/rules (config.status): Add --libexecdir option to
	configure.

	* schroot/run/00check: Print new environment variables.

	* schroot/setup/05lvm: Use schroot-releaselock to release snapshot
	device lock just prior to snapshot removal.

	* schroot/setup/00check: Print new environment variables.

	* schroot/schroot-setup.5.in: Document new environment variables.

	* schroot/sbuild-session.c (sbuild_session_setup_chroot): Add
	LIBEXEC_DIR and PID setup environment variables.

	* schroot/sbuild-chroot-lvm-snapshot.c
	(sbuild_chroot_lvm_snapshot_setup_lock): Don't unlock device at
	setup stop.

	* schroot/Makefile.am
	(pkglibexecdir): Set to $(SCHROOT_LIBEXEC_DIR).
	(pkglibexec_PROGRAMS): Add schroot-releaselock.

	* schroot/schroot-releaselock.c: New program to release device
	lock files using liblockdev.

	* configure.ac: Add SCHROOT_LIBEXEC_DIR define and substvar.

2005-10-17  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-lock.c (sbuild_lock_set_device_lock): Remove
	debugging print and sleep statements.

2005-10-17  Roger Leigh  <rleigh@debian.org>

	* Update documentation.

	* schroot/sbuild-chroot.c (sbuild_chroot_class_init): Remove the
	"current-users" and "max-users" properties, and associated object
	members and methods.

2005-10-17  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot-lvm-snapshot.c
	(sbuild_chroot_lvm_snapshot_setup_lock): The device lock is held
	on the source device during snapshotting (setup start), and on the
	snapshot device from run start to run stop and then during setup
	stop while the chroot is destroyed.

	* schroot/sbuild-chroot-block-device.c
	(sbuild_chroot_block_device_setup_lock): The device lock is held
	throughout the entire session.  It is acquired at setup start and
	released at setup stop.  This uses the new sbuild-lock device
	locking primitives.

	* schroot/sbuild-chroot.h: SbuildChrootSetupLockFunc uses a
	mutable chroot object.  All implementations of the setup_lock
	vfunc have been changed accordingly.

	* schroot/sbuild-lock.c
	(sbuild_lock_set_device_lock): New function.  Lock a device using
	liblockdev.
	(sbuild_lock_unset_device_lock): New function.  Unlock a device
	using liblockdev.

2005-10-14  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Bump version to 0.1.7.

	* debian/control (Build-Depends): Add liblockdev1-dev.

	* schroot/Makefile.am (schroot_LDADD): Add $(LOCKDEV_LIBS).

	* configure.ac: Check for liblockdev.

	* Bump version to 0.1.7.

2005-10-14  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.1.in: Restore session options.

	* schroot/schroot.c (parse_options): Restore session options.

2005-10-13  Roger Leigh  <rleigh@debian.org>

	* Version 0.1.6.

	* debian/changelog: Update

	* TODO: Update.

	* NEWS: Update.

	* schroot/schroot.1.in: Remove unused session options.

	* schroot/schroot.c: Disable unused session options.

2005-10-12  Roger Leigh  <rleigh@debian.org>

	* All manpages updated to document the new names and directory
	locations.

	* schroot/sbuild-chroot.h: Rename SBUILD_CHROOT_SETUP_START and
	SBUILD_CHROOT_SETUP_STOP to SBUILD_CHROOT_RUN_START and
	SBUILD_CHROOT_RUN_STOP.  Users of the enum changed to use the new
	names.

	* session.d script "session-start" and "session-stop" script
	arguments renamed to "run-start" and "run-stop".  All scripts
	changed to use the new names, and sbuild-session.c runs the
	scripts with the new new names.

	* Rename schroot/session to schroot/run.  Install scripts into
	$sysconfdir/schroot/run.d.  Update configure.ac, and
	schroot/Makefile.am.

2005-10-12  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.c (sbuild_session_setup_chroot): Use new
	function names.

	* schroot/sbuild-chroot-lvm-snapshot.c: Use new vfunc names.
	(sbuild_chroot_lvm_snapshot_setup_lock): stat devices, but still
	needs liblockdev support for full locking.

	* schroot/sbuild-chroot-block-device.c: Use new vfunc names.
	(sbuild_chroot_block_device_setup_lock): stat devices, but still
	needs liblockdev support for full locking.

	* schroot/sbuild-chroot-plain.c: Use new vfunc names.
	(sbuild_chroot_plain_setup_lock): Do no locking by default.

	* schroot/sbuild-chroot.c
	(sbuild_chroot_setup_lock): Renamed from
	setup_chroot_get_setup_name.
	(sbuild_chroot_setup_env): Renamed from sbuild_chroot_setup.
	(sbuild_chroot_class_init): Use new vfunc names.

	* schroot/sbuild-chroot.h (struct _SbuildChrootClass): Rename
	setup to setup_env and get_setup_name to setup_lock, which now
	returns gboolean on lock failure.

2005-10-05  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Manual pages say "schroot" rather than
	"sbuild".  Closes Debian Bug #331550.

	* schroot/schroot.conf.5.in: Use "schroot" rather than "sbuild".

2005-10-01  Roger Leigh  <rleigh@debian.org>

	* configure.ac: Output schroot-setup.5

	* schroot/Makefile.am (man_MANS): Add schroot-setup.5

	* schroot/schroot.1.in: Remove setup script documentation.

	* schroot/schroot-setup.5.in: New file, documenting setup script
	environment.

2005-10-01  Roger Leigh  <rleigh@debian.org>

	* schroot/setup/Makefile.am: Distribute 05lvm.

	* schroot/setup/10mount: Use new LVM variables, so snapshot names
	and mount locations are as set by the session.  Remove mount
	directory after unmounting, but only if it's under $MOUNT_DIR.

	* schroot/setup/05lvm: Use new LVM variables, so snapshot names
	and mount locations are as set by the session.

	* schroot/setup/00check, schroot/session/00check: Add MOUNT_DIR,
	SESSION_ID, CHROOT_LVM_SNAPSHOT_NAME and
	CHROOT_LVM_SNAPSHOT_DEVICE.

	* schroot/schroot.c
	(parse_options): Free the option context after use.
	(main): If a session ID was not specified, generate a UUID for the
	session.
	(main): Free the chroot list to make valgrind happy.

	* schroot/schroot.1.in: Document MOUNT_DIR, SESSION_ID,
	CHROOT_LVM_SNAPSHOT_NAME and CHROOT_LVM_SNAPSHOT_DEVICE
	environment variables.

	* schroot/sbuild-session.c
	(sbuild_session_get_session_id): session-id is no longer required
	to be a UUID.
	(sbuild_session_set_session_id): session-id is no longer required
	to be a UUID.  Allow setting of arbitrary strings.
	(sbuild_session_setup_chroot): Export MOUNT_DIR and SESSION_ID in
	the environment.
	(sbuild_session_run): Set the chroot mount location if the chroot
	did not already do so.
	(sbuild_session_run): For LVM snapshot chroots, set the snapshot
	name to the session ID.
	(sbuild_session_run): Cascade error handling properly on failure.
	(sbuild_session_class_init): Update session-id documentation now
	it is no longer a strict UUID.

	* schroot/sbuild-session.h (struct _SbuildSession): Change
	session_id type from uuid_t to gchar *.

	* schroot/sbuild-config.c (sbuild_config_load): Free GIOChannel,
	file data buffer and GKeyFile structure after use.

	* schroot/sbuild-chroot-lvm-snapshot.c
	(sbuild_chroot_lvm_snapshot_print_config): Don't print NULL
	values.
	(sbuild_chroot_lvm_snapshot_setup): Don't set NULL values.  Set
	snapshot device name (path stripped) as CHROOT_LVM_SNAPSHOT_NAME.
	(sbuild_chroot_lvm_snapshot_get_setup_name): Implement
	get_setup_name vfunc.  This is of the form block-major-minor,
	obtained by stat()ing the block device.  For setup-start, this is
	the source LV, but for all other cases is the snapshot LV.
	(sbuild_chroot_lvm_snapshot_class_init): Added new
	"snapshot-device" property.  The "device" property is slaved to
	this value, and indirectly, the "device" property is also slaved.

	* schroot/sbuild-chroot-lvm-snapshot.h (struct
	_SbuildChrootLvmSnapshot): New snapshot_device member.

	* schroot/sbuild-chroot-block-device.c
	(sbuild_chroot_block_device_print_details): Don't print NULL
	values.
	(sbuild_chroot_block_device_print_config): Don't print NULL
	values.
	(sbuild_chroot_block_device_setup): Don't set NULL values.
	(sbuild_chroot_block_device_get_setup_name): Implement
	get_setup_name vfunc.  This is of the form block-major-minor,
	obtained by stat()ing the block device.

	* schroot/sbuild-chroot-plain.c
	(sbuild_chroot_plain_print_details): Don't print NULL values.
	(sbuild_chroot_plain_print_config): Don't print NULL values.
	(sbuild_chroot_plain_setup): Don't set NULL values.
	(sbuild_chroot_plain_get_setup_name): Implement get_setup_name
	vfunc.  This is of the form directory-major-minor-inode, obtained
	by stat()ing the mount location.

	* schroot/sbuild-chroot.c
	(sbuild_chroot_set_properties_from_keyfile): Don't leak GKeyFile
	string and string vector values.
	(sbuild_chroot_get_setup_name): New function.  Get the name for
	e.g. locking during setup.
	(sbuild_chroot_print_details): Don't print NULL values.
	(sbuild_chroot_print_config): Don't print NULL values.
	(setup_env_string): New helper function to build environment list.
	(setup_env_unsigned): New helper function to build environment list.

	* schroot/sbuild-chroot.h (struct _SbuildChrootClass): Add
	get_setup_name vfunc.

	* schroot/sbuild-auth.c (sbuild_auth_setupenv): Don't leak new
	environment.

	* schroot/Makefile.am (install-data-hook): Create mount directory.

	* configure.ac (SCHROOT_MOUNT_DIR): Add mount directory.

2005-09-27  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-lock.c: Minor documentation and error message
	tidying.

2005-09-27  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-config.c (sbuild_config_load): Report GError
	messages propagated by locking failure.

	* schroot/sbuild-lock.c
	(sbuild_lock_set_lock): Return errors as a GError, rather than
	aborting.  Don't run fcntl in a while loop now that timeouts are
	implemented with an itimer.
	(sbuild_lock_unset_lock): Return errors as a GError.
	(sbuild_lock_error_quark): New function.

	* schroot/sbuild-lock.h (SBUILD_LOCK_ERROR): Add error domain.
	Add locking errors as SbuildLockError enum.

2005-09-27  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.conf.5.in: Update documentation.

	* schroot/sbuild-chroot.c (sbuild_chroot_class_init): The
	run-session-scripts property defaults to FALSE, for compatibility
	with dchroot out-of-the-box.

2005-09-27  Roger Leigh  <rleigh@debian.org>

	* Update documentation.

	* schroot/sbuild-config.c (sbuild_config_load): Acquire a read
	lock while reading schroot.conf.

	* schroot/schroot.h: Add sbuild-lock.h.

	* schroot/Makefile.am: Add sbuild-lock.[ch].

	* schroot/sbuild-lock.[ch]: New file, implementing simple
	whole-file advisory locking primitives.

2005-09-25  Roger Leigh  <rleigh@debian.org>

	* schroot/setup/00check: Remove "session-start" check.

	* schroot/session/00check: Remove duplicate "session-start" check.

	* schroot/session/50sbuild: New script to set up sbuild build
	directory and fix its ownership and permissions.

2005-09-25  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.1.in: Document new session.d directory.

	* schroot/schroot.conf.5.in: Document run-setup-scripts and
	run-session-scripts options.

	* schroot/sbuild-chroot.c (sbuild_chroot_class_init): Replace
	run-setup property and associated accessors with two new
	properties, run-setup-scripts and run-session-scripts and
	associated accessors.  Setup script are not run by default,
	whereas session scripts are.

	* schroot/sbuild-chroot.h (struct _SbuildChroot): Replace
	run_setup with two members, run_setup_scripts and
	run_session_scripts.

	* schroot/Makefile.am (SUBDIRS): Add session.

	* schroot/session/00check: New session script.

	* schroot/session/Makefile.am: New file for installing session
	scripts.

	* configure.ac (SCHROOT_CONF_SETUP_D): New define and substitution
	variable.

2005-09-25  Roger Leigh  <rleigh@debian.org>

	* Update API reference.

	* schroot/schroot.1.in: Document new command-line options.

	* schroot/schroot.c: Add new session_opt struct, with operation,
	id and force members.
	(parse_options): Add new command line options: -b/--begin-session,
	-r/--run-session, -e/--end-session and --force in a new "session"
	option group.  These options do not currently have any effect.
	(parse_session_options): New helper function to parse session
	options.
	(main): Set session operation when creating a new session.  Set
	additional session properties (session-id, force) after
	construction.

	* schroot/sbuild-session.c (sbuild_session_class_init): Added new
	"operation" and "force" properties, and associated accessors.
	(sbuild_session_new): Add operation argument, and set the
	operation contruction property.

	* schroot/sbuild-session.h: Added SbuildSessionOperation enum to
	specify session operations.
	(struct _SbuildSession): Added new operation and force members.

	* schroot/sbuild-chroot-lvm-snapshot.c
	(sbuild_chroot_lvm_snapshot_get_session_flags): New virtual
	function to get session flags.

	* schroot/sbuild-chroot-block-device.c
	(sbuild_chroot_block_device_get_session_flags): New virtual
	function to get session flags.

	* schroot/sbuild-chroot-plain.c
	(sbuild_chroot_plain_get_session_flags): New virtual function to
	get session flags.

	* schroot/sbuild-chroot.c
	(sbuild_chroot_get_session_flags): New function.  Calls
	get_session_flags vfunc.
	(sbuild_chroot_class_init): get_session_flags is pure virtual, so
	must be implemented in derived classes.

	* schroot/sbuild-chroot.h: Add SbuildChrootSessionFlags enum to
	specify chroot session behaviour.
	(struct _SbuildChrootClass): Added get_session_flags vfunc.

2005-09-24  Roger Leigh  <rleigh@debian.org>

	* debian/rules (config.status): Set $localstatedir when running configure.

2005-09-24  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.1.in: Document new setup script parameters.

	* Modify all setup scripts to use the new setup names.

	* schroot/sbuild-session.c
	(sbuild_session_setup_chroot): Use SbuildChrootSetupTyoe to run
	the four different types of setup operation.
	(sbuild_session_run): Run the four different kinds of setup script
	in the correct order.

	* schroot/sbuild-chroot.h: Add SbuildChrootSetupType enum to
	replace internal SbuildSessionChrootSetupType.  This has
	enumerations for starting and stopping both chroot setup and
	session setup.

2005-09-24  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot.c
	(sbuild_chroot_set_properties_from_keyfile): Split keyfile
	property code out from sbuild_chroot_new_from_keyfile.  This will
	allow re-reading chroot configuration from disk for session
	handling.

2005-09-24  Roger Leigh  <rleigh@debian.org>

	* debian/preinst, debian/postinst: Preserve schroot.conf changes
	correctly when moving to /etc/schroot/schroot.conf, by checking
	the md5sum to detect local modifictions.  If not modified, delete
	and replace with the package version.

2005-09-22  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.c (sbuild_session_run): Move chroot mount
	location fallback from sbuild_session_setup_chroot.

	* schroot/schroot.conf.5.in: Add additional "run-setup" notes.

2005-09-21  Roger Leigh  <rleigh@debian.org>

	* debian/changelog: Bump version to 0.1.6.  Document run-setup
	changes for Debian Bug #329403.

	* schroot/schroot.conf.5.in: Document "run-setup" configuration
	option.

	* schroot/sbuild-session.c (sbuild_session_run): Only run setup
	scripts if enabled in the chroot configuration.

	* schroot/sbuild-chroot.c
	(sbuild_chroot_class_init): Add "run-setup" property, and
	associated accessors.
	(sbuild_chroot_new_from_keyfile): Add support for G_TYPE_BOOLEAN
	properties as configuration options.

	* schroot/sbuild-chroot.h (struct _SbuildChroot): Add run_setup
	member.

2005-09-20  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot.c
	(sbuild_chroot_new_from_keyfile): Fix a memory leak during chroot
	type identification.  Reorganise code to make layout more logical.
	(sbuild_chroot_print_details): Format detail listing to make it
	more readable, in the same style as used by the LVM tools.

	* schroot/sbuild-config.c (sbuild_config_load): Only add chroots
	to the SbuildConfig if they were successfully constructed.

2005-09-18  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.c (sbuild_session_class_init): Add a new
	session-id property and associated accessors, which handle
	conversions between a string and uuid_t.

	* schroot/sbuild-session.h (struct _SbuildSession): Add a new
	session_id member containing the session UUID.

	* schroot/sbuild-config.c
	(sbuild_config_new_from_file): New function to replace
	sbuild_config_new.
	(sbuild_config_new_from_directory): New function to load a set of
	configuration files from a directory.
	(sbuild_config_class_init): config-file property is no longer
	readable.  Added new contruct only and write-only config-directory
	property.
	(sbuild_config_set_config_directory): New function to read a
	directory and load config files.
	(sbuild_config_load): Pass back the chroot list as an OUT
	parameter rather than a return value, to allow reusing the same
	list.
	(sbuild_config_set_config_file): Remove the restriction on loading
	a single config file.

	* schroot/sbuild-chroot-lvm-snapshot.c
	(sbuild_chroot_lvm_snapshot_print_config): New virtual function to
	print additional configuration details.

	* schroot/sbuild-chroot-block-device.c
	(sbuild_chroot_block_device_print_config): New virtual function to
	print additional configuration details.

	* schroot/sbuild-chroot-plain.c
	(sbuild_chroot_plain_print_config): New virtual function to print
	additional configuration details.

	* schroot/sbuild-chroot.c
	(sbuild_chroot_class_init): Added current-users, max-users and
	active properties, and associated accessors.
	(sbuild_chroot_new_from_keyfile): Add additional active parameter
	which is TRUE if reloading an existing session configuration.
	This relaxes permissions checks to allow setting of writable but
	not construction parameters.
	(sbuild_chroot_print_details): Print new properties.
	(sbuild_chroot_print_config): New function to write out current
	session state to a a configuration file for later restoration.
	(sbuild_chroot_setup): Set new properties as environment
	variables, except for active, since this is implicit in running a
	session).

	* schroot/sbuild-chroot.h
	(struct _SbuildChroot): Add current_users, max_users and active
	members.
	(struct _SbuildChrootClass): Add print_config vfunc.

	* debian/control (Build-Depends): Build-depend upon uuid-dev

	* schroot/Makefile.am
	(schroot_LDADD): Link with libuuid.
	(install-data-hook): Make SCHROOT_LOCK_DIR and
	SCHROOT_SESSION_DIR.

	* configure.ac:
	Check for libuuid and add UUID_CFLAGS to SCHROOT_CFLAGS.
	Add substitutions and defines for SCHROOT_LOCK_DIR and
	SCHROOT_SESSION_DIR.

2005-09-16  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-chroot.c (sbuild_chroot_new_from_keyfile):
	Require settable properties to be both constructible and writable.

2005-09-15  Roger Leigh  <rleigh@debian.org>

	* TODO: Update.

	* schroot/schroot.1.in: Document LVM snapshot script variables.

	* schroot/schroot.conf.5.in: Document LVM snapshot options.

	* schroot/setup/10mount: Hack LVM snapshot device name until it's
	supported by the session code.

	* schroot/setup/05lvm: New script to create and remove LVM
	snapshots.  Hack LVM snapshot device name until it's supported by
	the session code.

	* schroot/setup/00check: Report $CHROOT_LVM_SNAPSHOT_OPTIONS.

	* schroot/sbuild-chroot.c (sbuild_chroot_new_from_keyfile): Allow
	creation from type "lvm-snapshot".

	* schroot/sbuild-chroot-lvm-snapshot.[ch]: New files, implementing
	SbuildChrootLvmSnapshot, an object representing a chroot on a LVM
	logical volume which has a snapshot LV taken on demand, derived
	from SbuildChrootBlockDevice.

2005-09-15  Roger Leigh  <rleigh@debian.org>

	* schroot/setup/Makefile.am (setup_SCRIPTS): Distribute 00check
	and 10mount.

2005-09-15  Roger Leigh  <rleigh@debian.org>

	* schroot/setup/10mount: Use $CHROOT_MOUNT_DEVICE.

	* schroot/setup/00check: Report $CHROOT_MOUNT_DEVICE.

	* schroot/sbuild-chroot-plain.c: Minor indentation fixes.

	* schroot/sbuild-chroot-block-device.c
	(sbuild_chroot_block_device_set_mount_device): New function to
	slave the "device" property to the parent class "mount-device"
	property.
	Minor indentation fixes.

	* schroot/sbuild-chroot.c (sbuild_chroot_class_init): Added
	"mount-location" property and associated accessors.

	* schroot/sbuild-chroot.h (struct _SbuildChroot): Added
	mount_location member.

2005-09-15  Roger Leigh  <rleigh@debian.org>

	* schroot/setup/50chrootname: Use ${CHROOT_MOUNT_LOCATION}.

2005-09-14  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.conf.5.in: Document "mount-options".

	* schroot/setup/00check: Report $CHROOT_MOUNT_OPTIONS.

	* schroot/sbuild-chroot-block-device.c
	(sbuild_chroot_block_device_class_init): Added a "mount-options"
	property and associated accessors.

	* schroot/sbuild-chroot-block-device.h (struct
	_SbuildChrootBlockDevice): Added a mount_options member.

2005-09-14  Roger Leigh  <rleigh@debian.org>

	* Updated documentation.

	* schroot/setup/30passwd: Use $CHROOT_MOUNT_LOCATION.

	* schroot/setup/20network: Use $CHROOT_MOUNT_LOCATION.

	* schroot/setup/10mount: New script to mount block devices.

	* schroot/setup/00check: New script to do sanity checking before
	other scripts are run, and print the environment when run in
	verbose mode.

	* schroot/sbuild-session.c
	(sbuild_session_setup_chroot): Fall back to "/mnt" if no mount
	location is available.  This is temporary.
	(sbuild_session_setup_chroot): Set the environment correctly for
	subclassed SbuildChroot objects.
	(sbuild_session_setup_chroot_child_setup): New helper function to
	ensure that the setup scripts run as real and effective user and
	group root.

	* schroot/sbuild-chroot.c
	(sbuild_chroot_get_chroot_type): New function, which calls the
	get_type vfunc.
	(sbuild_chroot_class_init): Renamed "location" property to
	"mount-location", and updated all methods accordingly.  "location"
	is now implemented only in SbuildChrootPlain.
	(sbuild_chroot_new_from_keyfile): Check the GKeyFile "type" key to
	check which SbuildChroot subclass to instantiate.  Add stricter
	checking of GKeyFile keys, by validating names and types against
	the registered properties for the GObjectClass, as well as
	checking if the properties are constructible and writable.

	* schroot/sbuild-chroot.h (struct _SbuildChrootClass): Added new
	get_type vfunc, for getting the type name of the chroot.

	* schroot/sbuild-chroot-block-device.[ch]: New files, implementing
	SbuildChrootBlockDevice, an object representing a chroot on a
	block device mounted on demand, derived from SbuildChroot.

	* schroot/sbuild-chroot-plain.[ch]: New files, implementing
	SbuildChrootPlain, an object representing a simple filesystem
	chroot, derived from SbuildChroot.

	* NEWS: Bump version to 0.1.6.

	* configure.ac: Bump version to 0.1.6.

	* schroot/sbuild-chroot.c (sbuild_chroot_new_from_keyfile): Warn
	if not constructible or writable types are used.

2005-09-13  Roger Leigh  <rleigh@debian.org>

	* Translate g_warning messages.

	* schroot/schroot.c (main): When printing detailed chroot
	information, add a blank line between chroots.

	* schroot/sbuild-chroot.c (sbuild_chroot_new_from_keyfile): Parse
	options automatically by introspecting the GObject properties for
	a given chroot GType.  This will allow for automatic extension of
	the file format as new chroot types are added.

2005-09-12  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.c (sbuild_session_setup_chroot): Call
	sbuild_chroot_setup to get chroot environment variables, and add
	additional auth environment variables to the same linked list.
	Convert the linked list into a vector.

	* schroot/sbuild-chroot.c (sbuild_chroot_print_details): Call
	print_details vfunc.
	(sbuild_chroot_setup): New function, used to set the environment
	in setup scripts.  It calls the setup vfunc to allow derived
	classes to set additional environment variables.

	* schroot/sbuild-chroot.h:
	(struct _SbuildChrootClass): New print_details and setup virtual
	functions.

2005-09-11  Roger Leigh  <rleigh@debian.org>

	* Fixed minor typos in API reference.

	* Updated TODO.

2005-09-11  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.c (sbuild_session_setup_chroot): Set
	AUTH_VERBOSITY, not AUTH_VERBOSE.

	* schroot/setup/50chrootname: Use $AUTH_VERBOSITY.

	* schroot/setup/30passwd: Use $AUTH_VERBOSITY.

	* schroot/setup/20network: Use $AUTH_VERBOSITY.

	* schroot/schroot.c (main): Fix pointer type warning.

2005-09-11  Roger Leigh  <rleigh@debian.org>

	* Update API reference.

	* schroot/schroot.1.in: Document new option, and the
	AUTH_VERBOSITY environment variable used in setup scripts.

	* schroot/schroot.c
	(parse_options): Add a new --verbose option.
	(main): Set requested verbosity level.

	* schroot/sbuild-session.c
	(sbuild_session_setup_chroot): Check verbosity level to set in the
	environment, and to pass to run-parts.
	(sbuild_session_run_child): Check verbosity level when printing
	information about the command being run.

	* schroot/sbuild-auth.c
	(sbuild_auth_get_verbosity): Replacement for
	sbuild_auth_get_quiet.
	(sbuild_auth_set_verbosity): Replacement for
	sbuild_auth_set_quiet.
	(sbuild_auth_class_init): Replace "quiet" property with
	"verbosity" property.

	* schroot/sbuild-auth.h:
	Add SbuildAuthVerbosity enum to specify	message verbosity.
	(struct _SbuildAuth): Replace quiet member with verbosity member.

2005-09-11  Roger Leigh  <rleigh@debian.org>

	* Version 0.1.5.

	* po/en_GB.po: Update.

	* debian/changelog: Update.

2005-09-11  Roger Leigh  <rleigh@debian.org>

	* debian/rules: Install the lintian override.

	* debian/schroot.lintian-overrides: New file to override
	setuid-binary lintian warning.

2005-09-11  Roger Leigh  <rleigh@debian.org>

	* schroot/Makefile.am (EXTRA_DIST): Correctly distribute
	schroot.conf.

	* debian/copyright (License): Update the FSF address.

2005-09-11  Roger Leigh  <rleigh@debian.org>

	* configure.ac:
	Check for run-parts.
	Define $PACKAGE_SYSCONF_DIR as the location for configuration files.
	Define $SCHROOT_CONF_SETUP_D as the location for setup scripts.

	* schroot/Makefile.am (pkgsysconfdir): Install schroot.conf into
	$(PACKAGE_SYSCONF_DIR).

	* schroot/schroot.conf.5.in: Update date.

	* schroot/schroot.1.in: Add setup.d to FILES.  Update date.

	* schroot/setup/Makefile.am: Distribute and install 20network,
	30passwd and 50chrootname into $sysconfdir/schroot/setup.d.

	* schroot/setup/50chrootname: New file to set up chroot name in
	/etc/debian_chroot.

	* schroot/setup/30passwd: New file to set up passwd, shadow and
	group.

	* schroot/setup/20network: New file to set up resolv.conf.

	* schroot/sbuild-session.h: Add SBUILD_SESSION_ERROR_CHROOT_SETUP
	GError enum.

	* schroot/sbuild-session.c
	(sbuild_session_setup_chroot): New function to call run-parts(8).
	(sbuild_session_run): Call sbuild_session_setup_chroot before and
	after running the session command or shell.

2005-08-25  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.c (main): Replace SCHROOT_CONFIG_FILE with
	SCHROOT_CONF.

	* schroot/Makefile.am (DEFS): Remove SCHROOT_CONFIG_FILE.

	* schroot/schroot.conf.5.in: Use @SCHROOT_CONF@, rather than the
	incorrect @prefix@/etc/schroot.conf.

	* schroot/schroot.1.in: Use @SCHROOT_CONF@, rather than the
	incorrect @prefix@/etc/schroot.conf.

	* configure.ac (PACKAGE_SYSCONF_DIR): Compute the final value of
	$sysconfdir before configure ends, and substitute and define
	SCHROOT_CONF with the location of schroot.conf.

2005-08-22  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-auth.c (sbuild_auth_require_auth_impl): Remove
	special root priveleges.

	* schroot/sbuild-session.c (sbuild_session_require_auth): Remove
	special root priveleges.

2005-08-21  Roger Leigh  <rleigh@debian.org>

	* schroot/Makefile.am: Added new source files.

	* schroot/schroot.c (main): Add support for SbuildAuthConv
	timeouts.

	* schroot/schroot.h: Added new headers.

	* schroot/sbuild-marshallers.list: Added new marshaller
	BOOLEAN:UINT,BOXED.

	* configure.ac: Remove check for libpam_misc.  Bump version to
	0.1.5

	* schroot/sbuild-auth.c: Add support for the conv member as a
	GObject property:
	(sbuild_auth_get_conv): New function.
	(sbuild_auth_set_conv): New function.
	(sbuild_auth_conv): New function; glue to interface PAM to
	SbuildAuthConv.
	(sbuild_auth_start): Create a custom pam_conv which uses
	sbuild_auth_conv to hook back into SbuildAuthConv from PAM.

	* schroot/sbuild-auth.h: Add conv member to _SbuildAuthConv and
	sbuild_auth_get_conv and sbuild_auth_set_conv getters and setters,
	used to get and set the SbuildAuthConv interface used.

	* schroot/sbuild-auth-conv-tty.[ch]: New files, adding the
	SbuildAuthConvTty implementation of SbuildAuthConv.

	* schroot/sbuild-auth-conv.[ch]: New files, adding the
	SbuildAuthConv GInterface.

	* schroot/sbuild-auth-message.[ch] New files, adding the
	SbuildAuthMessagea and SbuildAuthMessageVector structures
	(registered as GBoxed types).

2005-07-31  Roger Leigh  <rleigh@debian.org>

	* Version 0.1.4.

	* NEWS: Update for 0.1.4.

	* po/en_GB.po: Update translation.

2005-07-31  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.c (sbuild_session_run_child): Alter the
	message printed to stderr or logged with syslog, depending on
	whether the environment is being preserved (no login shell) or not
	(login shell).

2005-07-31  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.c (main): Set the service name to "schroot".

	* schroot/sbuild-session.c (sbuild_session_new): Set the
	SbuildAuth "service" construction property.

	* schroot/sbuild-auth.h (struct _SbuildAuth): Add service member.

	* schroot/sbuild-auth.c: Don't hardcode the PAM service name:
	(sbuild_auth_get_service): New function.
	(sbuild_auth_set_service): New function.
	(sbuild_auth_start): Use the service member when initialising PAM.

2005-07-31  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.1.in: Include priority in the examples.

	* schroot/schroot.conf.5.in: Document new priority option and
	include it in the examples.

	* schroot/sbuild-chroot.h (struct _SbuildChroot): Add priority
	member.

	* schroot/sbuild-chroot.c
	(sbuild_chroot_get_priority): New function
	(sbuild_chroot_set_priority): New function
	(sbuild_chroot_new_from_keyfile): Parse priority

2005-07-31  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.c (parse_options): Fix typo in documentation.

	* schroot/sbuild-session.c (sbuild_session_require_auth): Simplify
	by removing all redundant checks.

2005-07-17  Roger Leigh  <rleigh@debian.org>

	* debian/control (Build-Depends): Add gettext.

	* Bump version numbers to 0.1.4.

2005-07-17  Roger Leigh  <rleigh@debian.org>

	* Version 0.1.3.

	* NEWS: Update for 0.1.3.

2005-07-17  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-auth.c (sbuild_auth_setupenv): Add USER and
	LOGNAME to the list of environment variables to set if not
	preserving the old environment.

2005-07-17  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-auth.c
	(sbuild_auth_get_home): Add home directory property and get
	function for the session user.
	(sbuild_auth_setupenv): Add HOME to the list of environment
	variables to set if not preserving the old environment.

2005-07-16  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.c
	(sbuild_session_run_chroot): Split into two separate functions,
	sbuild_session_run_child() and sbuild_session_wait_for_child().
	(sbuild_session_wait_for_child): Notify the "child-status"
	property on change.

2005-07-11  Roger Leigh  <rleigh@debian.org>

	* TODO: Update.

	* Update gtk-doc documentation.

2005-07-10  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.c (main): Abort earlier if no chroots are
	defined in schroot.conf.

2005-07-09  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.c (parse_options): Move the option entries[]
	array into the function as a static const variable.  Make sure the
	array is terminated by a null option entry, to prevent a segfault
	when parsing the options.

2005-07-08  Roger Leigh  <rleigh@debian.org>

	* TODO: Update.

	* schroot/schroot.c (main): Use new SBUILD_AUTH casts and methods,
	to replace the corresponding SBUILD_SESSION types and methods.

	* SbuildSession derives from SbuildAuth.
	  - The duplicated functionality has been removed from
	    SbuildSession.
	  - SbuildSession overrides the SbuildAuth virtual functions
	    require_auth and session_run.

2005-07-08  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.h: Add sbuild-auth.[ch].

	* schroot/sbuild-marshallers.list: Add new marshaller
	(sbuild_cclosure_marshal_BOOLEAN__BOXED).

	* Split SbuildSession PAM functionality into a separate SbuildAuth
	class, from which SbuildSession is derived.  SbuildAuth handles
	authentication and authorisation using PAM, with hooks for
	customising its behaviour.

2005-07-07  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-session.h, schroot/sbuild-config.h: Make error
	quark functions publicly visible.

2005-07-07  Roger Leigh  <rleigh@debian.org>

	* schroot/schroot.c
	(entries): Make entries const, to fix compiliation with gcc-4.0.
	(parse_options): Check for parse errors, and exit on error.

2005-07-07  Roger Leigh  <rleigh@debian.org>

	* schroot/sbuild-error.c, schroot/sbuild-error.h: Wrap GError as a
	GType (SBUILD_TYPE_ERROR and SBUILD_TYPE_ERROR_POINTER) for use
	with signals (GError * may be used as an "out" argument).

2005-07-05  Roger Leigh  <rleigh@debian.org>

	* po/.cvsignore: Ignore generated files.

2005-07-04  Roger Leigh  <rleigh@debian.org>

	* doc/schroot/schroot-docs.sgml: Include marshallers section.

	* doc/schroot/schroot-sections.txt: Add marshallers section.

	* schroot/schroot.h: New header.  This includes all other headers,
	and is used by glib-mkenums.

	* schroot/sbuild-marshallers.list: New file.  Generate a
	marshaller returning an enum and taking no arguments
	(sbuild_cclosure_marshal_ENUM__VOID).

	* schroot/Makefile.am: Generate GObject closure marshallers and
	GType typebuiltins.  Distribute the generated code.

2005-07-03  Roger Leigh  <rleigh@debian.org>

	* configure.ac, NEWS, debian/changelog: Increase version number to
	0.1.3.

2005-07-02  Roger Leigh  <rleigh@debian.org>

	* Version 0.1.2.

	* schroot/sbuild-session.c
	(sbuild_session_pam_setupenv): If no environment was specified,
	create an initial environment containing PATH and TERM.
	(sbuild_session_run_chroot): Search PATH for the specified
	command, in case the user didn't use an absolute path.

	* schroot/schroot.1.in: Add additional usage examples.

2005-07-02  Roger Leigh  <rleigh@debian.org>

	* README: Remove usage examples.

	* schroot/schroot.conf.5.in: Don't indent example.

	* schroot/schroot.1.in: Add usage examples.

2005-07-02  Roger Leigh  <rleigh@debian.org>

	* Updated README (translation and usage examples).

	* po/en_GB.po: Add British English translation.

	* po/en.po: Remove.

2005-06-25  Roger Leigh  <rleigh@debian.org>

	* debian/control (Standards-Version): Upgrade to Standards-Version
	3.6.2.

2005-06-25  Roger Leigh  <rleigh@debian.org>

	* configure.ac, NEWS, debian/changelog: Increase version number to
	0.1.2.

2005-06-25  Roger Leigh  <rleigh@debian.org>

	* Remove UCS characters from string literals.  For the time being,
	gettext will have to handle this.

	* Update .cvsignore files.

	* TODO: Remove gettext item.

	* po/en.po: Add an English translation, to make use of UTF-8
	characters.

	* schroot/Makefile.am, schroot/*.c: Mark up strings for
	translation with gettext, and add gettext and locale
	initialisation code to main().

	* Add po/POTFILES.in with all C source files included.

	* Add additional options to po/Makevars, to make xgettext read
	the source as UTF-8.

	* bootstrap, configure.ac, Makefile.am: add GNU gettext support.

2005-06-21  Roger Leigh  <rleigh@debian.org>

	* Version 0.1.1.

	* schroot/sbuild-config.c (sbuild_config_validate_chroots):
	  use g_return_val_if_fail, not g_return_if_fail.

	* configure.ac: Remove the automake "tar-pax" option, because the
	  Debian build infrastructure can't cope with it yet.

2005-06-21  Roger Leigh  <rleigh@debian.org>

	* Change all GPL boilerplate to use the new FSF postal address.

2005-06-21  Roger Leigh  <rleigh@debian.org>

	* debian/copyright:
	  - Update the postal address of the FSF.
	  - Refer to /usr/share/common-licenses/GPL.
	  - Add new download location.

	* Makefile.am: Remove CVS directories from the generated tarball.

	* schroot/schroot.conf.5.in: Correct .TH section from 1 to 5.

	* Remove debian/conffiles, which is not required by debhelper.

	* debian/control: Add buildd-tools developers to
	  Uploaders, and remove unused ${misc:Depends}.

	* debian/changelog: Update.

2005-06-21  Roger Leigh  <rleigh@debian.org>

	* Add .cvsignore files to replace lost .arch-inventory files.

2005-06-21  Roger Leigh  <rleigh@debian.org>

	* Add ChangeLog to CVS
	* No longer generate ChangeLog with "tla changelog".  It must now
	  be edited manually.

2005-06-20 23:06:04 GMT	Roger Leigh <rleigh@debian.org>	patch-1

    Summary:
      Add strict pointer checks and bump version
    Revision:
      schroot--mainline--0.1.1--patch-1

    - Add strict pointer checks to all function arguments and before
      dereferencing object members.
    - Increase version number to 0.1.1.

    modified files:
     NEWS configure.ac debian/changelog schroot/sbuild-chroot.c
     schroot/sbuild-config.c schroot/sbuild-session.c
     schroot/schroot.c


2005-06-20 15:45:19 GMT	Roger Leigh <rleigh@debian.org>	base-0

    Summary:
      tag of rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--version-0
    Revision:
      schroot--mainline--0.1.1--base-0

    (automatically generated log message)

    new patches:
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--base-0
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-1
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-2
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-3
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-4
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-5
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-6
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-7
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-8
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-9
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-10
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-11
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-12
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-13
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-14
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-15
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-16
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-17
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-18
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-19
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--patch-20
     rleigh@debian.org--2005-debian/schroot--mainline--0.1.0--version-0


2005-06-19 17:00:46 GMT	Roger Leigh <rleigh@debian.org>	version-0

    Summary:
      0.1.0 released.
    Revision:
      schroot--mainline--0.1.0--version-0

    - Preparation for 0.1.0.

    modified files:
     AUTHORS NEWS debian/changelog


2005-06-19 16:29:07 GMT	Roger Leigh <rleigh@debian.org>	patch-20

    Summary:
      Update configuration file
    Revision:
      schroot--mainline--0.1.0--patch-20

    - Comment out all entries in the sample configuration file, so that
      the installation is secure from the start.
    - Add comments to the top of the configuration file.

    modified files:
     schroot/schroot.conf


2005-06-19 15:55:26 GMT	Roger Leigh <rleigh@debian.org>	patch-19

    Summary:
      Add initial Debian packaging
    Revision:
      schroot--mainline--0.1.0--patch-19

    - Add debian directory and initial files.
    - Makefile.am: add debian to SUBDIRS.

    new files:
     debian/.arch-ids/=id debian/.arch-ids/README.Debian.id
     debian/.arch-ids/changelog.id debian/.arch-ids/compat.id
     debian/.arch-ids/conffiles.id debian/.arch-ids/control.id
     debian/.arch-ids/copyright.id debian/.arch-ids/docs.id
     debian/.arch-ids/rules.id debian/README.Debian
     debian/changelog debian/compat debian/conffiles debian/control
     debian/copyright debian/docs debian/rules

    modified files:
     Makefile.am

    new directories:
     debian debian/.arch-ids


2005-06-19 14:06:22 GMT	Roger Leigh <rleigh@debian.org>	patch-18

    Summary:
      Run a real login shell
    Revision:
      schroot--mainline--0.1.0--patch-18

    - SbuildSession: If no environment has been set, and no command has been
      specified, run a real login shell by prefixing - to argv[0].

    modified files:
     schroot/sbuild-session.c


2005-06-19 13:23:46 GMT	Roger Leigh <rleigh@debian.org>	patch-17

    Summary:
      Implement --quiet option
    Revision:
      schroot--mainline--0.1.0--patch-17

    - SbuildSession
      + Add "quiet" property, and get_quiet and set_quiet methods.
      + Only print fatal error messages if quiet is true.
    - schroot.c: If --quiet is used, set the session quiet status.

    modified files:
     TODO doc/schroot/schroot-sections.txt
     doc/schroot/tmpl/sbuild-session.sgml schroot/sbuild-session.c
     schroot/sbuild-session.h schroot/schroot.c


2005-06-19 13:01:06 GMT	Roger Leigh <rleigh@debian.org>	patch-16

    Summary:
      Add --enable-debug configure option
    Revision:
      schroot--mainline--0.1.0--patch-16

    - Add --enable-debug configure option
    - All source files include <config.h> to detect if debugging is
      enabled.
    - schroot.c: If debugging is enabled, install a null log handler
      for g_debug messages.
    - SbuildSession: add a missing "gid" property.
    - Add the initial project requirements file.

    new files:
     doc/.arch-ids/REQUIREMENTS.id doc/REQUIREMENTS

    modified files:
     configure.ac doc/schroot/tmpl/sbuild-session.sgml
     schroot/sbuild-chroot.c schroot/sbuild-config.c
     schroot/sbuild-session.c schroot/schroot.c


2005-06-19 11:32:37 GMT	Roger Leigh <rleigh@debian.org>	patch-15

    Summary:
      Enable preservation of user environment
    Revision:
      schroot--mainline--0.1.0--patch-15

    - SbuildSession:
      + Add public get_environment and set_environment methods, and
        an environment data member and property.
      + Add private pam_setupenv method to copy environment into PAM.
      + sbuild_session_run: After authentication has succeeded, call
        pam_setupenv.
    + schroot.c:
      Call sbuild_session_set_environment if required.

    modified files:
     TODO doc/schroot/schroot-sections.txt
     doc/schroot/tmpl/sbuild-session.sgml schroot/sbuild-session.c
     schroot/sbuild-session.h schroot/schroot.1.in
     schroot/schroot.c


2005-06-19 10:47:54 GMT	Roger Leigh <rleigh@debian.org>	patch-14

    Summary:
      Return child exit status
    Revision:
      schroot--mainline--0.1.0--patch-14

    - Propagate child exit status bacl to caller.
    - Update TODO.

    modified files:
     TODO doc/schroot/tmpl/sbuild-session.sgml
     schroot/sbuild-session.c schroot/sbuild-session.h
     schroot/schroot.c


2005-06-19 10:27:37 GMT	Roger Leigh <rleigh@debian.org>	patch-13

    Summary:
      Document internal API
    Revision:
      schroot--mainline--0.1.0--patch-13

    - Document internals (private functions).
    - Update TODO.

    modified files:
     TODO schroot/sbuild-chroot.c schroot/sbuild-config.c
     schroot/sbuild-session.c schroot/schroot.c


2005-06-18 23:37:36 GMT	Roger Leigh <rleigh@debian.org>	patch-12

    Summary:
      Update TODO
    Revision:
      schroot--mainline--0.1.0--patch-12

    - Remove gtk-doc item.

    modified files:
     TODO


2005-06-18 23:36:40 GMT	Roger Leigh <rleigh@debian.org>	patch-11

    Summary:
      Fix const correctness
    Revision:
      schroot--mainline--0.1.0--patch-11

    - schroot.c:
      + Cast const GList * to GList * to work around const-correctness
        bugs in GLib.
      + All options are non-const.

    modified files:
     schroot/schroot.c


2005-06-18 23:32:14 GMT	Roger Leigh <rleigh@debian.org>	patch-10

    Summary:
      Document all user-visible symbols.
    Revision:
      schroot--mainline--0.1.0--patch-10

    - Document all user-visible symbols with gtk-doc.

    modified files:
     doc/schroot/tmpl/sbuild-chroot.sgml
     doc/schroot/tmpl/sbuild-config.sgml
     doc/schroot/tmpl/sbuild-session.sgml schroot/sbuild-chroot.c
     schroot/sbuild-config.c schroot/sbuild-session.c


2005-06-18 21:45:22 GMT	Roger Leigh <rleigh@debian.org>	patch-9

    Summary:
      Add gtk-doc framework
    Revision:
      schroot--mainline--0.1.0--patch-9

    - Added gtk-doc API reference to doc/schroot.
    - Updated README.
    - Updated TODO.

    new files:
     doc/.arch-ids/=id doc/.arch-ids/Makefile.am.id doc/Makefile.am
     doc/schroot/.arch-ids/.arch-inventory.id
     doc/schroot/.arch-ids/=id doc/schroot/.arch-ids/Makefile.am.id
     doc/schroot/.arch-ids/schroot-docs.sgml.id
     doc/schroot/.arch-ids/schroot-overrides.txt.id
     doc/schroot/.arch-ids/schroot-sections.txt.id
     doc/schroot/.arch-ids/schroot.types.id
     doc/schroot/.arch-inventory doc/schroot/Makefile.am
     doc/schroot/schroot-docs.sgml
     doc/schroot/schroot-overrides.txt
     doc/schroot/schroot-sections.txt doc/schroot/schroot.types
     doc/schroot/tmpl/.arch-ids/=id
     doc/schroot/tmpl/.arch-ids/sbuild-chroot.sgml.id
     doc/schroot/tmpl/.arch-ids/sbuild-config.sgml.id
     doc/schroot/tmpl/.arch-ids/sbuild-session.sgml.id
     doc/schroot/tmpl/.arch-ids/schroot-unused.sgml.id
     doc/schroot/tmpl/sbuild-chroot.sgml
     doc/schroot/tmpl/sbuild-config.sgml
     doc/schroot/tmpl/sbuild-session.sgml
     doc/schroot/tmpl/schroot-unused.sgml

    modified files:
     Makefile.am README TODO configure.ac schroot/.arch-inventory
     schroot/Makefile.am schroot/sbuild-session.c
     schroot/sbuild-session.h

    new directories:
     doc doc/.arch-ids doc/schroot doc/schroot/.arch-ids
     doc/schroot/tmpl doc/schroot/tmpl/.arch-ids


2005-06-18 21:08:53 GMT	Roger Leigh <rleigh@debian.org>	patch-8

    Summary:
      Improve syslog support
    Revision:
      schroot--mainline--0.1.0--patch-8

    - schroot.c:
      + Use LOG_NDELAY with openlog(), otherwise messages in child processes
        are not correctly logged.
    - SbuildSession:
      + Log command or shell being run.
      + Log authentication or permissions failures.
      + Call pam_open_session correctly.

    modified files:
     schroot/sbuild-session.c schroot/schroot.c


2005-06-18 19:47:27 GMT	Roger Leigh <rleigh@debian.org>	patch-7

    Summary:
      Add session properties and PAM debugging statements
    Revision:
      schroot--mainline--0.1.0--patch-7

    - SbuildSession
      + Add read-only properties for uid, gid, shell, ruid and ruser.
      + Add PAM debugging statements to track PAM failure paths.
    - Updated TODO.

    modified files:
     TODO schroot/sbuild-session.c


2005-06-18 19:13:21 GMT	Roger Leigh <rleigh@debian.org>	patch-6

    Summary:
      Tighten up root access
    Revision:
      schroot--mainline--0.1.0--patch-6

    - sbuild_session_require_auth(): Check that the user is in both
      groups and root_groups for all chroots before granting access.

    modified files:
     schroot/sbuild-session.c


2005-06-18 12:30:50 GMT	Roger Leigh <rleigh@debian.org>	patch-5

    Summary:
      Add manual pages and TODO
    Revision:
      schroot--mainline--0.1.0--patch-5

    - Add sbuild.1.in and sbuild.conf.5.in manual pages.
    - Add TODO
    - Fix typo in sbuild-session.c.

    new files:
     .arch-ids/TODO.id TODO schroot/.arch-ids/schroot.1.in.id
     schroot/.arch-ids/schroot.conf.5.in.id schroot/schroot.1.in
     schroot/schroot.conf.5.in

    modified files:
     configure.ac schroot/Makefile.am schroot/sbuild-session.c


2005-06-18 12:20:34 GMT	Roger Leigh <rleigh@debian.org>	patch-4

    Summary:
      Improve session error handling and authorisation
    Revision:
      schroot--mainline--0.1.0--patch-4

    - SbuildSession:
      + Use GError checks with nested conditionals so that we can shut down
        the PAM library in the correct order on failure.  The first failure
        only is reported in the case of multiple errors being propagated.
      + The root user is always granted unconditional access
      + If the host and chroot user are the same, authentication is not
        required.
      + If the user is not in groups, they do not get any access, even
        with a password.  root access still needs tighter checking.

    modified files:
     schroot/sbuild-session.c


2005-06-18 10:37:12 GMT	Roger Leigh <rleigh@debian.org>	patch-3

    Summary:
      Split PAM calls into separate functions
    Revision:
      schroot--mainline--0.1.0--patch-3

    - SbuildSession:
      + Each PAM call (or related set of calls) is a separate function
        (sbuild_session_pam_*).
      + PAM errors are propagated back to the caller using GError.
      + sbuild_session_run prototype changed to propagate any PAM or
        session errors to the caller.
    - SbuildConfig:
      + sbuild.conf does not require root group ownership, to allow
        more flexible administration.
    - schroot.c: Use GError to detect any session errors.

    modified files:
     schroot/sbuild-config.c schroot/sbuild-session.c
     schroot/sbuild-session.h schroot/schroot.c


2005-06-17 22:00:59 GMT	Roger Leigh <rleigh@debian.org>	patch-2

    Summary:
      Add PAM configuration file
    Revision:
      schroot--mainline--0.1.0--patch-2

    - Add schroot/pam/schroot containing a PAM configuration file to
      install in /etc/pam.d/schroot.

    new files:
     schroot/pam/.arch-ids/=id schroot/pam/.arch-ids/Makefile.am.id
     schroot/pam/.arch-ids/schroot.id schroot/pam/Makefile.am
     schroot/pam/schroot

    modified files:
     configure.ac schroot/Makefile.am

    new directories:
     schroot/pam schroot/pam/.arch-ids


2005-06-17 20:52:04 GMT	Roger Leigh <rleigh@debian.org>	patch-1

    Summary:
      Add autotools framework
    Revision:
      schroot--mainline--0.1.0--patch-1

    - Add support for autoconf, automake and libtool.
    - Add support for gtk-doc.
    - Install schroot setuid root.
    - Add --version option and embed version number in the output.
    - Add AUTHORS and NEWS files.
    - Generate ChangeLog with tla.

    new files:
     .arch-ids/AUTHORS.id .arch-ids/Makefile.am.id
     .arch-ids/NEWS.id .arch-ids/bootstrap.id
     .arch-ids/configure.ac.id AUTHORS Makefile.am NEWS bootstrap
     configure.ac schroot/.arch-ids/Makefile.am.id
     schroot/Makefile.am

    modified files:
     schroot/schroot.c


2005-06-17 17:51:17 GMT	Roger Leigh <rleigh@debian.org>	base-0

    Summary:
      Initial import
    Revision:
      schroot--mainline--0.1.0--base-0

    Initial import into GNU Arch.

    new files:
     COPYING README schroot/sbuild-chroot.c schroot/sbuild-chroot.h
     schroot/sbuild-config.c schroot/sbuild-config.h
     schroot/sbuild-session.c schroot/sbuild-session.h
     schroot/schroot.c schroot/schroot.conf
