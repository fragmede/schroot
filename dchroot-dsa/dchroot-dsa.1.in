.\" Copyright Â© 2005-2006  Roger Leigh <rleigh@debian.org>
.\"
.\" schroot is free software; you can redistribute it and/or modify it
.\" under the terms of the GNU General Public License as published by
.\" the Free Software Foundation; either version 2 of the License, or
.\" (at your option) any later version.
.\"
.\" schroot is distributed in the hope that it will be useful, but
.\" WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
.\" General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public License
.\" along with this program; if not, write to the Free Software
.\" Foundation, Inc., 59 Temple Place, Suite 330, Boston,
.\" MA  02111-1307  USA
.TH DCHROOT-DSA 1 "@RELEASE_DATE@" "Version @VERSION@" "Debian sbuild"
.SH NAME
dchroot\-dsa \- enter a chroot environment
.SH SYNOPSIS
.B dchroot\-dsa
[\fIOPTION\fP]... [chroot] [\fICOMMAND\fP]
.SH DESCRIPTION
\fBdchroot\-dsa\fP allows the user to run a command or a login shell in a
chroot environment.  If no command is specified, a login shell will be started
in the user's home directory inside the chroot.
.PP
The user's environment will be preserved inside the chroot.
.PP
The command is a single argument which must be an absolute path to the program.
Additional options are not permitted.
.PP
The login shell or command will run in the user's home directory inside the
chroot, or / if the home directory is not available.
.PP
This version of \fBdchroot\-dsa\fP is a compatibility wrapper around the
.BR schroot (1)
program.  It is provided for backward compatibility with the \fBdchroot\-dsa\fP
command-line options, but \fBschroot\fP is recommended for future use.  See the
section \[lq]\fIMigration\fP\[rq] below for help migrating your existing
\fBdchroot\-dsa\fP configuration to \fBschroot\fP.  See the section
\[lq]\fIIncompatibilities\fP\[rq] below for known incompatibilities with
\fBdchroot\-dsa\fP.
.PP
.SH OPTIONS
\fBdchroot\-dsa\fP accepts the following options:
.SS Basic options
.TP
.B \-h, \-\-help
Show help summary.
.TP
.B \-a, \-\-all
Select all chroots.  Note that the original \fBdchroot\-dsa\fP did not include
this option.
.TP
.B \-c, \-\-chroot=\fIchroot\fP
Specify a chroot to use.  This option may be used multiple times to specify
more than one chroot, in which case its effect is similar to \fB\-\-all\fP.  If
this option is not used, the first non-option argument specified the chroot to
use.  Note that the original \fBdchroot\-dsa\fP did not include this option.
.TP
.B \-l, \-\-list
List all available chroots.
.TP
.B \-i, \-\-info
Print detailed information about the available chroots.  Note that the original
\fBdchroot\-dsa\fP did not include this option.
.TP
.B \-p, \-\-listpaths
Print absolute locations (paths) of the available chroots.
.TP
.B \-\-config
Print configuration of the available chroots.  This is useful for testing that
the configuration in use is the same as the configuration file.  Any comments
in the original file will be missing.  Note that the original
\fBdchroot\-dsa\fP did not include this option.
.TP
.B \-q, \-\-quiet
Print only essential messages.  Note that the original \fBdchroot\-dsa\fP did
not include this option.
.TP
.B \-v, \-\-verbose
Print all messages.  Note that the original \fBdchroot\-dsa\fP did not include
this option.
.TP
.B \-V, \-\-version
Print version information.
.SH CONFIGURATION
The original \fBdchroot\-dsa\fP configuration file, \fI@DCHROOT_CONF@\fP has
the following format:
.IP \[bu]
\[oq]#\[cq] starts a comment line.
.IP \[bu]
Blank lines are ignored.
.IP \[bu]
Chroot definitions are a single line containing an \fIidentifier\fP,
\fIpath\fP, and an optional \fIuser list\fP separated by whitespace (space and
tab), or a colon (\[oq]:\[cq]), semicolon (\[oq];\[cq]), or comma
(\[oq],\[cq]).
.PP
An example file:
.PP
.RS
\f[CR]# Example comment\fP
.br
\f[CR]\fP
.br
\f[CR]sarge /srv/chroot/sarge\fP
.br
\f[CR]sid /srv/chroot/sid rleigh,fred\fP
.br
.RE
.PP
This file defines a chroot called \[oq]sarge\[cq], located at
\fI/srv/chroot/sarge\fP, and a second chroot called \[oq]sid\[cq], located at
\fI/srv/chroot/sid\fP.  The second chroot specifies that it may only be used by
the users \[lq]rleigh\[rq] and \[lq]fred\[rq].
.SH INCOMPATIBILITIES
.SS DSA dchroot
.IP \[bu]
Log messages are worded and formatted differently.
.IP \[bu]
\fBdchroot\-dsa\fP provides a restricted subset of the functionality
implemented by \fBschroot\fP, but is still \fBschroot\fP underneath.  Thus
\fBdchroot\-dsa\fP is still subject to \fBschroot\fP security checking,
including PAM authentication and authorisation, and session management, for
example, and hence may behave slightly differently to the original
\fBdchroot\-dsa\fP in some circumstances.
.IP \[bu]
The command argument in this version may be absolute or relative, and may
contain as many options as desired.  The original version only allowed a single
absolute program name and no options.
.SS Debian dchroot
A \fBdchroot\fP package provides an alternative \fBdchroot\fP implementation.
.IP \[bu]
All the above incompatibilities apply.
.IP \[bu]
This version of dchroot has incompatible command-line options, and while some
of those options are supported or have equivalent options by a different name,
the \fI\-c\fP option is required to specify a chroot.  It also allows a shell
script to be used as the option instead of a single absolute path.
.IP \[bu]
This version of dchroot has an incompatible format for \fIdchroot.conf\fP.
While the first two fields are the same, the third field is a optional
personality, instead of the list of users permitted to access the chroot
allowed by this version.  If personality support is needed, please use
\fIschroot.conf\fP and add the allowed users there, as shown in
\[lq]\fIMigration\fP\[rq] below.
.SH MIGRATION
To migrate an existing \fBdchroot\-dsa\fP configuration to \fBschroot\fP,
perform the following steps:
.IP 1
Dump the \fBdchroot\-dsa\fP configuration in \fBschroot\fP keyfile format to
\fI@SCHROOT_CONF@\fP.
.PP
.RS
\f[CR]# \f[CB]dchroot\-dsa --config >> @SCHROOT_CONF@
.br
.RE
.PP
.IP 2
Edit \fI@SCHROOT_CONF@\fP to add access to the groups who are to be allowed to
access the chroots, and make any other desired changes to the configuration.
See
.BR schroot.conf (5).
.IP 3
Remove \fI@DCHROOT_CONF@\fP, so that \fBdchroot\-dsa\fP will subsequently use
\fI@SCHROOT_CONF@\fP for its configuration.  If the \fBdchroot\fP package is
still installed, purge it, or else delete the file.
.SH EXAMPLES
\f[CR]$ dchroot\-dsa -l\fP
.br
\f[CR]Available chroots: sarge, sid\fP
.br
\f[CR]\fP
.br
\f[CR]$ dchroot\-dsa \-\-listpaths\fP
.br
\f[CR]/srv/chroot/sarge\fP
.br
\f[CR]/srv/chroot/sid\fP
.br
\f[CR]\fP
.br
\f[CR]$ dchroot\-dsa \-q sid \-\- /bin/uname\fP
.br
\f[CR]Linux\fP
.br
\f[CR]\fP
.br
\f[CR]$ dchroot\-dsa sid\fP
.br
\f[CR]I: [sid chroot] Running login shell: \[lq]/bin/bash\[rq]\fP
.br
\f[CR]$ \fP
.br
.LP
Use \fB\-\-\fP to allow options beginning with \[oq]\-\[cq] or \[oq]\-\-\[cq]
in the command to run in the chroot.  This prevents them being interpreted as
options for \fBschroot\fP itself.  Note that the top line was echoed to
standard error, and the remaining lines to standard output.  This is
intentional, so that program output from commands run in the chroot may be
piped and redirected as required; the data will be the same as if the command
was run directly on the host system.
.SH TROUBLESHOOTING
If something is not working, and it's not clear from the error messages what is
wrong, try using the \fB\-\-debug\fP option to turn on debugging messages.
This gives a great deal more information.
.PP
If you are still having trouble, the developers may be contacted on the mailing
list:
.br
Debian buildd-tools Developers <buildd-tools-devel@lists.alioth.debian.org>
.SH BUGS
None known at this time.
.SH FILES
.TP
.I @DCHROOT_CONF@
The system-wide \fBdchroot\-dsa\fP chroot definition file.  This file must be
owned by the root user, and not be writable by other.  If present, this file
will be used in preference to @SCHROOT_CONF@.
.TP
.I @SCHROOT_CONF@
The system-wide \fBschroot\fP definition file.  This file must be owned by the
root user, and not be writable by other.  It is recommended that this file be
used in preference to \fI@DCHROOT_CONF@\fP, because the chroots can be used
interchangeably with \fBschroot\fP, and the group security policies provided by
\fBschroot\fP are also enforced.
.SH AUTHORS
Roger Leigh.
.PP
This implementation of \fBdchroot\-dsa\fP uses the same command-line options as
the original \fBdchroot\-dsa\fP found on machines run by the Debian System
Administrators for the Debian Project have a \fBdchroot-dsa\fP source package
which also provides a \fBdchroot\-dsa\fP package.
.SH COPYRIGHT
Copyright \(co 2005-2006  Roger Leigh <rleigh@debian.org>
.PP
This program is free software; you can redistribute it and/or modify it
under the terms of the GNU General Public License as published by the Free
Software Foundation; either version 2 of the License, or (at your option)
any later version.
.SH SEE ALSO
.BR schroot (1),
.BR sbuild (1),
.BR chroot (2),
.BR schroot-setup (5),
.BR schroot.conf (5).
.\"#
.\"# The following sets edit modes for GNU EMACS
.\"# Local Variables:
.\"# mode:nroff
.\"# fill-column:79
.\"# End:
