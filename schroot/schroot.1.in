.\" Copyright Â© 2005-2006  Roger Leigh <rleigh@debian.org>
.\"
.\" schroot is free software; you can redistribute it and/or modify it
.\" under the terms of the GNU General Public License as published by
.\" the Free Software Foundation; either version 2 of the License, or
.\" (at your option) any later version.
.\"
.\" schroot is distributed in the hope that it will be useful, but
.\" WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
.\" General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public License
.\" along with this program; if not, write to the Free Software
.\" Foundation, Inc., 59 Temple Place, Suite 330, Boston,
.\" MA  02111-1307  USA
.TH SCHROOT 1 "28 Jan 2006" "Version @VERSION@" "Debian sbuild"
.SH NAME
schroot \- securely enter a chroot environment
.SH SYNOPSIS
.B schroot
[\fIOPTION\fP]... [\fICOMMAND\fP]
.SH DESCRIPTION
\fBschroot\fP allows the user to run a command or a login shell in a chroot
environment.  If no command is specified, a login shell will be started in the
user's current working directory inside the chroot.
.PP
If the user is not a member of the allowed groups (or if changing to root, the
allowed root groups) for the specified chroot(s), the user will be required to
authenticate themselves (typically with a password, but this depends upon the
PAM configuration).  All chroot usage will be logged in the system logs.
.PP
If no chroot is specified, the chroot name or alias \fBdefault\fP will be used
as a fallback.  This is equivalent to \[lq]\-\-chroot=default\[rq].
.SH OPTIONS
\fBschroot\fP accepts the following options:
.SS Basic options
.TP
.B \-h, \-\-help
Show help summary.
.TP
.B \-\-help\-all
Show all help, including advanced options.
.TP
.B \-\-help\-session
Show session options.
.TP
.B \-a, \-\-all
Select all chroots and active sessions.  When a command has been specified, the
command will be run in all chroots and active sessions.  If \fB\-\-info\fP has
been used, display information about all chroots.  This option does not make
sense to use with a login shell (when no command has been specified).  This
option is equivalent to \fB\-\-all\-chroots\fP \fB\-\-all\-sessions\fP.
.TP
.B \-a, \-\-all\-chroots
Select all chroots.  Identical to \fB\-\-all\fP, but active sessions are not
considered.
.TP
.B \-a, \-\-all\-chroots
Select all active sessions.  Identical to \fB\-\-all\fP, but chroots are not
considered.
.TP
.B \-c, \-\-chroot=\fIchroot\fP
Specify a chroot to use.  This option may be used multiple times to specify
more than one chroot, in which case its effect is similar to \fB\-\-all\fP.
.TP
.B \-u, \-\-user=\fIuser\fP
Run as a different user.  The default is to run as the current user.  If
required, the user may be required to authenticate themselves with a password.
.TP
.B \-l, \-\-list
List all available chroots.
.TP
.B \-i, \-\-info
Print detailed information about the specified chroots.
.TP
.B \-\-config
Print configuration of the specified chroots.
.TP
.B \-p, \-\-preserve\-environment
Preserve the user's environment inside the chroot environment.  The default is
to use a clean environment; this option copies the entire user environment and
sets it in the session.
.TP
.B \-q, \-\-quiet
Print only essential messages.
.TP
.B \-v, \-\-verbose
Print all messages.
.TP
.B \-V, \-\-version
Print version information.
.SS Session options
.TP
.B \-b, \-\-begin\-session
Begin a session.  A unique session identifier (UUID) is returned on standard
output.  The UUID is required to use the other session options.
.TP
.TP
.B \-\-recover\-session
Recover an existing session.  If an existing session has become unavailable,
for example becoming unmounted due to a reboot, this option will make the
session available for use again, for example by remounting it.
.B \-r, \-\-run\-session=\fIUUID\fP
Run an existing session.
.TP
.B \-e, \-\-end\-session=\fIUUID\fP
End an existing session.
.TP
.B \-f, \-\-force
Force a session operation, even if it would otherwise fail.  This may be used
to forcibly end a session, even if it has active users.  This does not
guarantee that the session will be ended cleanly; filesystems may not be
unmounted, for example.
.SH EXAMPLES
\f[CR]$ \f[CB]schroot \-l\fP\fP
.br
\f[CR]default\fP
.br
\f[CR]etch\fP
.br
\f[CR]sid\fP
.br
\f[CR]testing\fP
.br
\f[CR]unstable\fP
.br
\f[CR]\fP
.PP
\f[CR]$ \f[CB]schroot \-i \-c sid\fP\fP
.br
\f[CR]Name: sid\fP
.br
\f[CR]Description: Debian unstable\fP
.br
\f[CR]Location: /srv/chroot/sid\fP
.br
\f[CR]Priority: 3\fP
.br
\f[CR]Groups: sbuild\fP
.br
\f[CR]Root Groups: root\fP
.br
\f[CR]Aliases: unstable default\fP
.LP
Use \-\-all or \-c multiple times to use all or multiple chroots, respectively.
.PP
\f[CR]$ \f[CB]schroot \-c sid /bin/ls\fP\fP
.br
\f[CR][sid chroot] Running command: \[lq]/bin/ls\[rq]\fP
.br
\f[CR]CVS          sbuild\-chroot.c   sbuild\-session.h  schroot.conf.5\fP
.br
\f[CR]Makefile     sbuild\-chroot.h   schroot.1         schroot.conf.5.in\fP
.br
\f[CR]Makefile.am  sbuild\-config.c   schroot.1.in\fP
.br
\f[CR]Makefile.in  sbuild\-config.h   schroot.c\fP
.br
\f[CR]pam          sbuild\-session.c  schroot.conf\fP
.PP
\f[CR]$ \f[CB]schroot \-c sid \-\- ls \-1 | head \-n 5\fP\fP
.br
\f[CR][sid chroot] Running command: \[lq]ls \-1\[rq]\fP
.br
\f[CR]ABOUT-NLS\fP
.br
\f[CR]AUTHORS\fP
.br
\f[CR]COPYING\fP
.br
\f[CR]ChangeLog\fP
.br
\f[CR]INSTALL\fP
.LP
Use \fB\-\-\fP to allow options beginning with \[oq]\-\[cq] or \[oq]\-\-\[cq]
in the command to run in the chroot.  This prevents them being interpreted as
options for schroot itself.  Note that the top line was echoed to standard
error, and the remaining lines to standard output.  This is intentional, so
that program output from commands run in the chroot may be piped and redirected
as required; the data will be the same as if the command was run directly on
the host system.
.PP
\f[CR]$ \f[CB]schroot \-c sid \-u root\fP\fP
.br
\f[CR]Password:\FP
.br
\f[CR][sid chroot] (rleigh\[->]root) Running login shell: \[lq]/bin/bash\[rq]\fP
.br
\f[CR]# \fP
.LP
If the user \[lq]rleigh\[rq] was in \fIroot\-groups\fP in \fIschroot.conf\fP,
they would be granted root access without authentication, but the PAM
authorisation step is still applied.
.SH BUGS
None known at this time.
.SH FILES
.TP
.I @SCHROOT_CONF@
The system-wide chroot definition file.  This file must be owned by the root
user, and not be writable by other.
.TP
.I @SCHROOT_CONF_SETUP_D@
.TP
.I @SCHROOT_CONF_RUN_D@
The system-wide chroot setup and run directories.  See
.BR schroot-setup (5).
.TP
.I /etc/pam.d/schroot
PAM configuration.
.SH AUTHORS
Roger Leigh.
.SH COPYRIGHT
Copyright \(co 2005-2006  Roger Leigh <rleigh@debian.org>
.PP
This program is free software; you can redistribute it and/or modify it
under the terms of the GNU General Public License as published by the Free
Software Foundation; either version 2 of the License, or (at your option)
any later version.
.SH SEE ALSO
.BR dchroot (1),
.BR sbuild (1),
.BR chroot (2),
.BR schroot-setup (5),
.BR schroot.conf (5).
.\"#
.\"# The following sets edit modes for GNU EMACS
.\"# Local Variables:
.\"# mode:nroff
.\"# fill-column:79
.\"# End:
