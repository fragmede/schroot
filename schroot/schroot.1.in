.\" Copyright Â© 2005  Roger Leigh <rleigh@debian.org>
.\"
.\" schroot is free software; you can redistribute it and/or modify it
.\" under the terms of the GNU General Public License as published by
.\" the Free Software Foundation; either version 2 of the License, or
.\" (at your option) any later version.
.\"
.\" schroot is distributed in the hope that it will be useful, but
.\" WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
.\" General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public License
.\" along with this program; if not, write to the Free Software
.\" Foundation, Inc., 59 Temple Place, Suite 330, Boston,
.\" MA  02111-1307  USA
.TH SCHROOT 1 "11 Sep 2005" "Version @VERSION@" "Debian sbuild"
.SH NAME
schroot \- securely enter a chroot environment
.SH SYNOPSIS
.B schroot
[\fIOPTION\fP]... [\fICOMMAND\fP]
.SH DESCRIPTION
\fBsbuild\fP allows the user to run a command or a login shell in a chroot
environment.  If no command is specified, a login shell will be started in the
user's current working directory inside the chroot.
.PP
If the user is not a member of the allowed groups (or if changing to root, the
allowed root groups) for the specified chroot(s), the user will be required to
authenticate themselves (typically with a password, but this depends upon the
PAM configuration).  All chroot usage will be logged in the system logs.
.SH OPTIONS
\fBschroot\fP accepts the following options:
.SS Basic options
.TP
.B \-?, \-\-help
Show help summary.
.TP
.B \-\-help\-all
Show all help, including advanced options.
.TP
.B \-\-help\-session
Show session options.
.TP
.B \-a, \-\-all
Use all chroots.  When a command has been specified, the command will be run in
all chroots.  If \fB\-\-info\fP has been used, display information about all
chroots.  This option does not make sense to use with a login shell (when no
command has been specified).
.TP
.B \-c, \-\-chroot=\fIchroot\fP
Specify a chroot to use.  This option may be used multiple times to specify
more than one chroot, in which case its effect is similar to \fB\-\-all\fP.
.TP
.B \-u, \-\-user=\fIuser\fP
Run as a different user.  The default is to run as the current user.  If
required, the user may be required to authenticate themselves with a password.
.TP
.B \-l, \-\-list
List all available chroots.
.TP
.B \-i, \-\-info
Print detailed information about the specified chroots.
.TP
.B \-p, \-\-preserve\-environment
Preserve the user's environment inside the chroot environment.  The default is
to use a clean environment; this option copies the entire user environment and
sets it in the session.
.TP
.B \-q, \-\-quiet
Print only essential messages.
.TP
.B \-v, \-\-verbose
Print all messages.
.TP
.B \-V, \-\-version
Print version information.
.SS Session options
.TP
.B \-b, \-\-begin\-session
Begin a session.  A unique session identifier (UUID) is returned on standard
output.  The UUID is required to use the other session options.
.TP
.B \-r, \-\-run\-session=\fIUUID\fP
Run an existing session.
.TP
.B \-e, \-\-end\-session=\fIUUID\fP
End an existing session.
.TP
.B \-f, \-\-force
Force a session operation, even if it would otherwise fail.  This may be used
to forcibly end a session, even if it has active users.  This does not
guarantee that the session will be ended cleanly; filesystems may not be
unmounted, for example.
.SH EXAMPLES
\f[CR]$ \f[CB]schroot \-l\fP\fP
.br
\f[CR]default\fP
.br
\f[CR]etch\fP
.br
\f[CR]sid\fP
.br
\f[CR]testing\fP
.br
\f[CR]unstable\fP
.br
\f[CR]\fP
.PP
\f[CR]$ \f[CB]schroot \-i \-c sid\fP\fP
.br
\f[CR]Name: sid\fP
.br
\f[CR]Description: Debian unstable\fP
.br
\f[CR]Location: /srv/chroot/sid\fP
.br
\f[CR]Priority: 3\fP
.br
\f[CR]Groups: sbuild\fP
.br
\f[CR]Root Groups: root\fP
.br
\f[CR]Aliases: unstable default\fP
.LP
Use \-\-all or \-c multiple times to use all or multiple chroots, respectively.
.PP
\f[CR]$ \f[CB]schroot \-c sid /bin/ls\fP\fP
.br
\f[CR][sid chroot] Running command: \[lq]/bin/ls\[rq]\fP
.br
\f[CR]CVS          sbuild\-chroot.c   sbuild\-session.h  schroot.conf.5\fP
.br
\f[CR]Makefile     sbuild\-chroot.h   schroot.1         schroot.conf.5.in\fP
.br
\f[CR]Makefile.am  sbuild\-config.c   schroot.1.in\fP
.br
\f[CR]Makefile.in  sbuild\-config.h   schroot.c\fP
.br
\f[CR]pam          sbuild\-session.c  schroot.conf\fP
.PP
\f[CR]$ \f[CB]schroot \-c sid \-\- ls \-1 | head \-n 5\fP\fP
.br
\f[CR][sid chroot] Running command: \[lq]ls \-1\[rq]\fP
.br
\f[CR]ABOUT-NLS\fP
.br
\f[CR]AUTHORS\fP
.br
\f[CR]COPYING\fP
.br
\f[CR]ChangeLog\fP
.br
\f[CR]INSTALL\fP
.LP
Use \fB\-\-\fP to allow options beginning with \[oq]\-\[cq] or \[oq]\-\-\[cq]
in the command to run in the chroot.  This prevents them being interpreted as
options for schroot itself.  Note that the top line was echoed to standard
error, and the remaining lines to standard output.  This is intentional, so
that program output from commands run in the chroot may be piped and redirected
as required; the data will be the same as if the command was run directly on
the host system.
.PP
\f[CR]$ \f[CB]schroot \-c sid \-u root\fP\fP
.br
\f[CR]Password:\FP
.br
\f[CR][sid chroot] (rleigh\[->]root) Running login shell: \[lq]/bin/bash\[rq]\fP
.br
\f[CR]# \fP
.LP
If the user \[lq]rleigh\[rq] was in \fIroot\-groups\fP in \fIschroot.conf\fP,
they would be granted root access without authentication, but the PAM
authorisation step is still applied.
.SH BUGS
None known at this time.
.SH FILES
.TP
.I @SCHROOT_CONF@
The system-wide chroot definition file.  This file must be owned by the root
user, and not be writable by other.
.TP
.I @SCHROOT_CONF_SETUP_D@
.TP
.I @SCHROOT_CONF_SESSION_D@
The system-wide chroot setup and session directories.  These directories
contain scripts run when a chroot is created and destroyed, and entered and
left, respectively, used to set up and then clean up the chroot environment.
During script execution, the following environment variables are defined:
.RS
.SS General variables
.TP
AUTH_USER
The username of the user the command in the chroot will run as.
.TP
AUTH_VERBOSITY
Set to \[lq]quiet\[rq] if only error messages should be printed,
\[lq]normal\[rq] if other messages may be printed as well, and
\[lq]verbose\[rq] if all messages may be printed.
.TP
CHROOT_TYPE
The type of the chroot.  This is useful for restricting a setup task to
particular types of chroot (e.g. only block devices or LVM snapshots).
.TP
CHROOT_NAME
The name of the chroot.  This is useful for restricting a setup task to a
particular chroot, or set of chroots.
.TP
CHROOT_DESCRIPTION
The description of the chroot.
.TP
CHROOT_MOUNT_LOCATION
The location to mount the chroot (or, in the case of plain chroots, where it
already exists).
.TP
CHROOT_MOUNT_DEVICE
The device containing the chroot root filesystem.  This is only set for chroots
which require mounting.
.TP
CHROOT_CURRENT_USERS
The number of users currently using the chroot.
.TP
CHROOT_MAX_USERS
The maximum number of users able to use the chroot.
.SS Plain chroot variables
.TP
CHROOT_LOCATION
The location of the chroot.  This is useful for creating files, or copying
files into the chroot.
.SS Block device variables
.TP
CHROOT_DEVICE
The device containing the chroot root filesystem.  This usually, but not
necessarily the device which will be mounted.  For example, an LVM snapshot
this will be the original logical volume.
.TP
CHROOT_MOUNT_OPTIONS
Options to pass to
.BR mount (8).
.SS LVM snapshot variables
.TP
CHROOT_LVM_SNAPSHOT_OPTIONS
Options to pass to
.BR lvcreate (8).
.RE
.PP
The scripts are run in name order, like those run by
.BR init (8),
by using
.BR run-parts (8).
When a session is first started, the chroot is set up by running the scripts in
@SCHROOT_CONF_SETUP_D@ with the \[lq]setup-start\[rq] option.  When a command
or shell is run in the configured chroot, the scripts in
@SCHROOT_CONF_SESSION_D@ are run with the \[lq]session-start\[rq] option.
After the command or command has completed, the scripts are run in reverse
order with the \[lq]session-stop\[rq] option.  Finally, when the session is
ended, the scripts in @SCHROOT_CONF_SETUP_D@ are run in reverse order with the
\[lq]setup-stop\[rq] option.
.TP
.I /etc/pam.d/schroot
PAM configuration.
.SH AUTHORS
Roger Leigh.
.SH COPYRIGHT
Copyright \(co 2005  Roger Leigh <rleigh@debian.org>
.PP
This program is free software; you can redistribute it and/or modify it
under the terms of the GNU General Public License as published by the Free
Software Foundation; either version 2 of the License, or (at your option)
any later version.
.SH SEE ALSO
.BR dchroot (1),
.BR sbuild (1),
.BR chroot (2),
.BR schroot.conf (5).
.\"#
.\"# The following sets edit modes for GNU EMACS
.\"# Local Variables:
.\"# mode:nroff
.\"# fill-column:79
.\"# End:
