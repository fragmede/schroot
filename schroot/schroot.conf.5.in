.\" Copyright Â© 2005-2006  Roger Leigh <rleigh@debian.org>
.\"
.\" schroot is free software; you can redistribute it and/or modify it
.\" under the terms of the GNU General Public License as published by
.\" the Free Software Foundation; either version 2 of the License, or
.\" (at your option) any later version.
.\"
.\" schroot is distributed in the hope that it will be useful, but
.\" WITHOUT ANY WARRANTY; without even the implied warranty of
.\" MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
.\" General Public License for more details.
.\"
.\" You should have received a copy of the GNU General Public License
.\" along with this program; if not, write to the Free Software
.\" Foundation, Inc., 59 Temple Place, Suite 330, Boston,
.\" MA  02111-1307  USA
.TH SCHROOT.CONF 5 "28 Jan 2006" "Version @VERSION@" "Debian sbuild"
.SH NAME
schroot.conf \- chroot definition file for schroot
.SH DESCRIPTION
\fBschroot.conf\fP is a plain UTF-8 text file, describing the chroots available
for use with sbuild.
.PP
Comments are introduced following a \[oq]\f[CR]\[sh]\fP\[cq] (\[lq]hash\[rq])
character at the beginning of a line, or following any other text.  All text
right of the \[oq]\f[CR]\[sh]\fP\[cq] is treated as a comment.
.PP
The configuration format is an INI-style format based upon the GLib GKeyFile
parser, and is fully documented in the GLib API reference.  Here, only the
features used and required by schroot are documented.
.SS
General options
.PP
A chroot is defined as a group of key-value pairs, which is started by a name
in square brackets on a line by itself.  The file may contain multiple groups
which therefore define multiple chroots.
.PP
A chroot definition is started by the name of the chroot in square brackets.
For example,
.IP
\f[CR]\[lB]sid\[rB]
.PP
This is then followed by several key-value pairs:
.TP
.B type=\fItype\fP
The type of the chroot.  Valid types are \[lq]plain\[rq], \[lq]file\[rq],
\[lq]block\-device\[rq] and \[lq]lvm\-snapshot\[rq].  If empty or omitted, the
default type is \[lq]plain\[rq].
.TP
.B description=\fIdescription\fP
A short description of the chroot.  This may be localised for different
languages; see the section \[lq]\fILocalisation\fP\[rq] below.
.TP
.B priority=\fInumber\fP
Set the priority of a chroot.  \fInumber\fP is a positive integer indicating
whether a distribution is older than another.  For example, \[lq]oldstable\[rq]
and \[lq]oldstable-security\[rq] might be 0, while \[lq]stable\[rq] and
\[lq]stable-security\[rq] 1, \[lq]testing\[rq] 2 and \[lq]unstable\[rq] 3.  The
values are not important, but the difference between them is.  This is used by
sbuild when using the schroot chroot mode.
.TP
.B groups=\fIgroup1,group2,...\fP
A comma-separated list of groups which are allowed access to the chroot.  If
empty or omitted, no users will be allowed access.
.TP
.B root\-groups=\fIgroup1,group2,...\fP
A comma-separated list of groups which are allowed \fBpassword-less\fP root
access to the chroot.  If empty or omitted, no users will be allowed root
access without a password (but if a user's group is in \fBgroups\fP, they may
gain access with a password).
.TP
.B aliases=\fIalias1,alias2,...\fP
A comma-separated list of aliases (alternate names) for this chroot.  For
example, a chroot named \[lq]sid\[rq] might have an \[lq]unstable\[rq] alias
for convenience.
.TP
.B run\-setup\-scripts=\fItrue\fP|\fIfalse\fP
Set whether chroot setup scripts will be run.  The default is not to run setup
scripts (\[lq]false\[rq]), for safety reasons (so it won't clobber your passwd
and other critical files).  The default for session-managed chroots
(\[lq]file\[rq] and \[lq]lvm\-snapshot\[rq]) is to run setup scripts.  If
\fItype\fP is set to a value other than \[lq]plain\[rq], setup scripts are
\fBrequired\fP to mount and configure the chroot environment.  If enabled for a
\[lq]plain\[rq] chroot, the chroot will support simple session management (not
true session management, because it does not make a copy of the chroot).  If
your chroots are exclusively controlled by schroot, set to \[lq]true\[rq].
.TP
.B run\-exec\-scripts=\fItrue\fP|\fIfalse\fP
Set whether chroot execution scripts will be run.  The default is the same as
the default for the \fIrun-setup-scripts\fP key.  This option was called
\fIrun-setup-scripts\fP in releases up to version 0.2.5.
.TP
.B command\-prefix=\fIcommand,option1,option2,...\fP
A comma-separated list of a command and the options for the command.  This
command and its options will be prefixed to all commands run inside the chroot.
.TP
.B personality=\fIpersona\fP
Set the personality (process execution domain) to use.  This option is useful
when using a 32-bit chroot on 64-bit system, for example.  Valid options on
Linux are \[lq]bsd\[rq], \[lq]hpux\[rq], \[lq]irix32\[rq], \[lq]irix64\[rq],
\[lq]irixn32\[rq], \[lq]iscr4\[rq], \[lq]linux\[rq], \[lq]linux32\[rq],
\[lq]linux_32bit\[rq], \[lq]osf4\[rq], \[lq]osr5\[rq], \[lq]riscos\[rq],
\[lq]scorvr3\[rq], \[lq]solaris\[rq], \[lq]sunos\[rq], \[lq]svr4\[rq],
\[lq]uw7\[rq], \[lq]wysev386\[rq], and \[lq]xenix\[rq].  The default value is
\[lq]linux\[rq].  There are also the special option \[lq]undefined\[rq]
(personality not set).  For a 32-bit chroot on a 64-bit system,
\[lq]linux32\[rq], is the option required.  The only valid option for non-Linux
systems is \[lq]undefined\[rq].  The default value is \[lq]undefined\[rq].
.SS
Plain chroots
.PP
Chroots of type \[lq]plain\[rq] are directories accessible in the filesystem.
They have an additional (mandatory) configuration option:
.TP
.B location=\fIdirectory\fP
The directory containing the chroot environment.  This is where the root will
be changed to when executing a login shell or a command.  The directory must
exist and have read and execute permissions to allow users' access to it.
.SS
File chroots
.PP
Chroots of type \[lq]file\[rq] are files on the current filesystem containing
an archive of the chroot files.  They implement the \fBsource chroot\fP options
(see \[lq]source chroot options\[rq], below) and have an additional (mandatory)
configuration option:
.TP
.B file=\fIfilename\fP
The file containing the archived chroot environment.  This must be a tar (tape
archive), optionally compressed with gzip or bzip2, or a zip archive.  The file
extensions used to determine the type are are \fI.tar\fP, \fI.tar.gz\fP,
\fI.tar.bz2\fP, \fI.tgz\fP, \fI.tbz\fP and \fI.zip\fP.  This file must be owned
by the root user, and not be writable by other.
.SS
Block device chroots
.PP
Chroots of type \[lq]block\-device\[rq] are a filesystem available on an
unmounted block device.  The device will be mounted and unmounted on demand.
They have additional options:
.TP
.B device=\fIdevice\fP
This is the device name of the block device, including the absolute path.  For
example, \[lq]/dev/sda5\[rq].
.TP
.B mount-options=\fImount_options\fP
Mount options for the block device.  These are additional options to pass to
mount(8).  For example, \[lq]\-o atime,sync,user_xattr\[rq].
.TP
.B location=\fIpath\fP
This is the path to the chroot \fIinside\fP the filesystem on the device.  For
example, if the filesystem contains a chroot in \fI/chroot/sid\fP, you would
specify \fB/chroot/sid\fP here.  If the chroot is the only thing on the
filesystem, i.e. \fI/\fP is the root filesystem for the chroot, this option
should be left blank, or omitted entirely.
.SS
LVM snapshot chroots
.PP
Chroots of type \[lq]lvm\-snapshot\[rq] are a filesystem available on an LVM
logical volume (LV).  A snapshot LV will be created from this LV on demand, and
then the snapshot will be mounted.  At the end of the session, the snapshot LV
will be unmounted and removed.  For each chroot of this type, a corresponding
\[lq]block\-device\[rq] chroot will be created, with a \fI\-source\fP suffix
appended to the chroot name and all its aliases; this is for convenient access
to the source device.
.PP
They implement the \fBsource chroot\fP options (see \[lq]source chroot
options\[rq], below), and all the options for \[lq]block\-device\[rq], plus an
additional option:
.TP
.B lvm-snapshot-options=\fIsnapshot_options\fP
Snapshot options.  These are additional options to pass to lvcreate(8).  For
example, \[lq]\-L 2g\[rq] to create a snapshot 2 GiB in size.
.B Note:
the LV name (\[lq]\-n\[rq]), the snapshot option (\[lq]\-s\[rq]) and the
original LV path may not be specfied here; they are set automatically by
schroot.
.SS Source chroot options
.PP
Some chroots implement source chroots.  These are chroots which automatically
create a copy of themselves before use, and are usually session managed.  These
chroots also provide an additional chroot with a \fI\-source\fP suffix added to
their name, to allow access to the original data, to aid in chroot maintenance.
These chroots provide the following additional options:
.TP
.B source\-groups=\fIgroup1,group2,...\fP
A comma-separated list of groups which are allowed access to the source chroot.
If empty or omitted, no users will be allowed access.  This will become the
\fIgroups\fP option in the source chroot.
.TP
.B source\-root\-groups=\fIgroup1,group2,...\fP
A comma-separated list of groups which are allowed \fBpassword-less\fP root
access to the source chroot.  If empty or omitted, no users will be allowed
root access without a password (but if a user's group is in \fBgroups\fP, they
may gain access with a password).  This will become the \fIroot\-groups\fP
option in the source chroot.
.SS Localisation
.PP
Some keys may be localised in multiple lanuages.  This is achieved by adding
the locale name in square brackets after the key name.  For example:
.br
.RS
\f[CR]description[en_GB]=\f[CI]British English translation\fP\fP
.br
.RE
.PP
This will localise the \fIdescription\fP key for the en_GB locale.
.RS
\f[CR]description[fr]=\f[CI]French translation\fP\fP
.br
.RE
.PP
This will localise the \fIdescription\fP key for all French locales.
.br
.SH EXAMPLE
\f[CR]# Sample configuration\fP
.br
\f[CR]\fP
.br
\f[CR][sid]\fP
.br
\f[CR]type=plain\fP
.br
\f[CR]description=Debian unstable\fP
.br
\f[CR]description[fr_FR]=Debian instable\fP
.br
\f[CR]location=/srv/chroot/sid\fP
.br
\f[CR]priority=3\fP
.br
\f[CR]groups=sbuild\fP
.br
\f[CR]root-groups=root\fP
.br
\f[CR]aliases=unstable,default\fP
.br
\f[CR]\fP
.br
\f[CR][etch]\fP
.br
\f[CR]type=block-device\fP
.br
\f[CR]description=Debian testing\fP
.br
\f[CR]priority=2\fP
.br
\f[CR]#groups=sbuild-security\fP
.br
\f[CR]aliases=testing\fP
.br
\f[CR]device=/dev/hda_vg/etch_chroot\fP
.br
\f[CR]mount-options=-o atime\fP
.br
\f[CR]run-setup-scripts=true\fP
.br
\f[CR]run-exec-scripts=true\fP
.br
\f[CR]\fP
.br
\f[CR][sid-file]\fP
.br
\f[CR]type=file\fP
.br
\f[CR]description=Debian sid file\-based chroot\fP
.br
\f[CR]priority=3\fP
.br
\f[CR]groups=sbuild\fP
.br
\f[CR]file=/srv/chroots/sid.tar.gz\fP
.br
\f[CR]run-setup-scripts=true\fP
.br
\f[CR]run-exec-scripts=true\fP
.br
\f[CR]\fP
.br
\f[CR][sid-snapshot]\fP
.br
\f[CR]type=lvm-snapshot\fP
.br
\f[CR]description=Debian unstable LVM snapshot\fP
.br
\f[CR]priority=3\fP
.br
\f[CR]groups=sbuild\fP
.br
\f[CR]root-groups=root\fP
.br
\f[CR]device=/dev/hda_vg/sid_chroot\fP
.br
\f[CR]mount-options=-o atime,sync,user_xattr\fP
.br
\f[CR]lvm-snapshot-options=--size 2G\fP
.br
\f[CR]run-setup-scripts=true\fP
.br
\f[CR]run-exec-scripts=true\fP
.SH FILES
.TP
.I @SCHROOT_CONF@
The system-wide chroot definition file.  This file must be owned by the root
user, and not be writable by other.
.SH AUTHORS
Roger Leigh.
.SH COPYRIGHT
Copyright \(co 2005-2006  Roger Leigh <rleigh@debian.org>
.PP
This program is free software; you can redistribute it and/or modify it
under the terms of the GNU General Public License as published by the Free
Software Foundation; either version 2 of the License, or (at your option)
any later version.
.SH SEE ALSO
.BR sbuild (1),
.BR schroot (1),
.BR mount (8).
.\"#
.\"# The following sets edit modes for GNU EMACS
.\"# Local Variables:
.\"# mode:nroff
.\"# fill-column:79
.\"# End:
